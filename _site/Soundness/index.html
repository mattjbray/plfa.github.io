<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">The Book</a>
                <a class="page-link" href="/Announcements/">Announcements</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
                <a class="page-link" href="/Citing/">Citing</a>
                <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="183" class="Keyword">module</a> <a id="190" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="205" class="Keyword">where</a>
</pre>

<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="1069" class="Keyword">open</a> <a id="1074" class="Keyword">import</a> <a id="1081" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="1096" class="Keyword">using</a> <a id="1102" class="Symbol">(</a><a id="1103" href="/Untyped/#2906" class="Datatype">Context</a><a id="1110" class="Symbol">;</a> <a id="1112" href="plfa.Untyped.html#2944" class="InductiveConstructor Operator">_,_</a><a id="1115" class="Symbol">;</a> <a id="1117" href="plfa.Untyped.html#3259" class="Datatype Operator">_∋_</a><a id="1120" class="Symbol">;</a> <a id="1122" href="plfa.Untyped.html#4028" class="Datatype Operator">_⊢_</a><a id="1125" class="Symbol">;</a> <a id="1127" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="1128" class="Symbol">;</a> <a id="1130" href="plfa.Untyped.html#3295" class="InductiveConstructor">Z</a><a id="1131" class="Symbol">;</a> <a id="1133" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S_</a><a id="1135" class="Symbol">;</a> <a id="1137" href="plfa.Untyped.html#4064" class="InductiveConstructor Operator">`_</a><a id="1139" class="Symbol">;</a> <a id="1141" href="plfa.Untyped.html#4116" class="InductiveConstructor Operator">ƛ_</a><a id="1143" class="Symbol">;</a> <a id="1145" href="plfa.Untyped.html#4176" class="InductiveConstructor Operator">_·_</a><a id="1148" class="Symbol">;</a>
         <a id="1159" href="/Untyped/#6697" class="Function">subst</a><a id="1164" class="Symbol">;</a> <a id="1166" href="plfa.Untyped.html#7225" class="Function Operator">_[_]</a><a id="1170" class="Symbol">;</a> <a id="1172" href="plfa.Untyped.html#7109" class="Function">subst-zero</a><a id="1182" class="Symbol">;</a> <a id="1184" href="plfa.Untyped.html#5659" class="Function">ext</a><a id="1187" class="Symbol">;</a> <a id="1189" href="plfa.Untyped.html#5969" class="Function">rename</a><a id="1195" class="Symbol">;</a> <a id="1197" href="plfa.Untyped.html#6405" class="Function">exts</a><a id="1201" class="Symbol">)</a>
<a id="1203" class="Keyword">open</a> <a id="1208" class="Keyword">import</a> <a id="1215" href="/LambdaReduction/" class="Module">plfa.LambdaReduction</a>
  <a id="1238" class="Keyword">using</a> <a id="1244" class="Symbol">(</a><a id="1245" href="/LambdaReduction/#345" class="Datatype Operator">_—→_</a><a id="1249" class="Symbol">;</a> <a id="1251" href="plfa.LambdaReduction.html#395" class="InductiveConstructor">ξ₁</a><a id="1253" class="Symbol">;</a> <a id="1255" href="plfa.LambdaReduction.html#485" class="InductiveConstructor">ξ₂</a><a id="1257" class="Symbol">;</a> <a id="1259" href="plfa.LambdaReduction.html#575" class="InductiveConstructor">β</a><a id="1260" class="Symbol">;</a> <a id="1262" href="plfa.LambdaReduction.html#683" class="InductiveConstructor">ζ</a><a id="1263" class="Symbol">;</a> <a id="1265" href="plfa.LambdaReduction.html#837" class="Datatype Operator">_—↠_</a><a id="1269" class="Symbol">;</a> <a id="1271" href="plfa.LambdaReduction.html#944" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1278" class="Symbol">;</a> <a id="1280" href="plfa.LambdaReduction.html#887" class="InductiveConstructor Operator">_[]</a><a id="1283" class="Symbol">)</a>
<a id="1285" class="Keyword">open</a> <a id="1290" class="Keyword">import</a> <a id="1297" href="/Substitution/" class="Module">plfa.Substitution</a> <a id="1315" class="Keyword">using</a> <a id="1321" class="Symbol">(</a><a id="1322" href="plfa.Substitution.html#2218" class="Function">Rename</a><a id="1328" class="Symbol">;</a> <a id="1330" href="plfa.Substitution.html#2431" class="Function">Subst</a><a id="1335" class="Symbol">;</a> <a id="1337" href="plfa.Substitution.html#3072" class="Function">ids</a><a id="1340" class="Symbol">)</a>
<a id="1342" class="Keyword">open</a> <a id="1347" class="Keyword">import</a> <a id="1354" href="/Denotational/" class="Module">plfa.Denotational</a>
  <a id="1374" class="Keyword">using</a> <a id="1380" class="Symbol">(</a><a id="1381" href="/Denotational/#3958" class="Datatype">Value</a><a id="1386" class="Symbol">;</a> <a id="1388" href="plfa.Denotational.html#3978" class="InductiveConstructor">⊥</a><a id="1389" class="Symbol">;</a> <a id="1391" href="plfa.Denotational.html#7096" class="Function">Env</a><a id="1394" class="Symbol">;</a> <a id="1396" href="plfa.Denotational.html#9270" class="Datatype Operator">_⊢_↓_</a><a id="1401" class="Symbol">;</a> <a id="1403" href="plfa.Denotational.html#7253" class="Function Operator">_`,_</a><a id="1407" class="Symbol">;</a> <a id="1409" href="plfa.Denotational.html#4313" class="Datatype Operator">_⊑_</a><a id="1412" class="Symbol">;</a> <a id="1414" href="plfa.Denotational.html#8058" class="Function Operator">_`⊑_</a><a id="1418" class="Symbol">;</a> <a id="1420" href="plfa.Denotational.html#8261" class="Function">`⊥</a><a id="1422" class="Symbol">;</a> <a id="1424" href="plfa.Denotational.html#8290" class="Function Operator">_`⊔_</a><a id="1428" class="Symbol">;</a> <a id="1430" href="plfa.Denotational.html#7490" class="Function">init</a><a id="1434" class="Symbol">;</a> <a id="1436" href="plfa.Denotational.html#7545" class="Function">last</a><a id="1440" class="Symbol">;</a> <a id="1442" href="plfa.Denotational.html#7594" class="Function">init-last</a><a id="1451" class="Symbol">;</a>
         <a id="1462" href="/Denotational/#5467" class="Function">Refl⊑</a><a id="1467" class="Symbol">;</a> <a id="1469" href="plfa.Denotational.html#4610" class="InductiveConstructor">Trans⊑</a><a id="1475" class="Symbol">;</a> <a id="1477" href="plfa.Denotational.html#8544" class="Function">`Refl⊑</a><a id="1483" class="Symbol">;</a> <a id="1485" href="plfa.Denotational.html#25004" class="Function">Env⊑</a><a id="1489" class="Symbol">;</a> <a id="1491" href="plfa.Denotational.html#8612" class="Function">EnvConjR1⊑</a><a id="1501" class="Symbol">;</a> <a id="1503" href="plfa.Denotational.html#8709" class="Function">EnvConjR2⊑</a><a id="1513" class="Symbol">;</a> <a id="1515" href="plfa.Denotational.html#25432" class="Function">up-env</a><a id="1521" class="Symbol">;</a>
         <a id="1532" href="/Denotational/#9324" class="InductiveConstructor">var</a><a id="1535" class="Symbol">;</a> <a id="1537" href="plfa.Denotational.html#9403" class="InductiveConstructor">↦-elim</a><a id="1543" class="Symbol">;</a> <a id="1545" href="plfa.Denotational.html#9541" class="InductiveConstructor">↦-intro</a><a id="1552" class="Symbol">;</a> <a id="1554" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a><a id="1561" class="Symbol">;</a> <a id="1563" href="plfa.Denotational.html#9740" class="InductiveConstructor">⊔-intro</a><a id="1570" class="Symbol">;</a> <a id="1572" href="plfa.Denotational.html#9871" class="InductiveConstructor">sub</a><a id="1575" class="Symbol">;</a>
         <a id="1586" href="/Denotational/#23412" class="Function">rename-pres</a><a id="1597" class="Symbol">;</a> <a id="1599" href="plfa.Denotational.html#17211" class="Function">ℰ</a><a id="1600" class="Symbol">;</a> <a id="1602" href="plfa.Denotational.html#17393" class="Function Operator">_≃_</a><a id="1605" class="Symbol">;</a> <a id="1607" href="plfa.Denotational.html#17798" class="Function">≃-trans</a><a id="1614" class="Symbol">)</a>
<a id="1616" class="Keyword">open</a> <a id="1621" class="Keyword">import</a> <a id="1628" href="/Compositional/" class="Module">plfa.Compositional</a> <a id="1647" class="Keyword">using</a> <a id="1653" class="Symbol">(</a><a id="1654" href="plfa.Compositional.html#3566" class="Function">lambda-inversion</a><a id="1670" class="Symbol">;</a> <a id="1672" href="plfa.Compositional.html#9665" class="Function">var-inv</a><a id="1679" class="Symbol">)</a>

<a id="1682" class="Keyword">open</a> <a id="1687" class="Keyword">import</a> <a id="1694" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1734" class="Keyword">using</a> <a id="1740" class="Symbol">(</a><a id="1741" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1744" class="Symbol">;</a> <a id="1746" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">_≢_</a><a id="1749" class="Symbol">;</a> <a id="1751" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1755" class="Symbol">;</a> <a id="1757" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1760" class="Symbol">;</a> <a id="1762" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1766" class="Symbol">;</a> <a id="1768" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a><a id="1773" class="Symbol">;</a> <a id="1775" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a><a id="1783" class="Symbol">)</a>
<a id="1785" class="Keyword">open</a> <a id="1790" class="Keyword">import</a> <a id="1797" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1810" class="Keyword">using</a> <a id="1816" class="Symbol">(</a><a id="1817" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1820" class="Symbol">;</a> <a id="1822" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#139" class="Record">Σ</a><a id="1823" class="Symbol">;</a> <a id="1825" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="1833" class="Symbol">;</a> <a id="1835" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">∃</a><a id="1836" class="Symbol">;</a> <a id="1838" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">∃-syntax</a><a id="1846" class="Symbol">;</a> <a id="1848" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="1853" class="Symbol">;</a> <a id="1855" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="1860" class="Symbol">)</a>
  <a id="1864" class="Keyword">renaming</a> <a id="1873" class="Symbol">(</a><a id="1874" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1878" class="Symbol">to</a> <a id="1881" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1886" class="Symbol">)</a>
<a id="1888" class="Keyword">open</a> <a id="1893" class="Keyword">import</a> <a id="1900" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1915" class="Keyword">using</a> <a id="1921" class="Symbol">(</a><a id="1922" href="Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1927" class="Symbol">)</a>
<a id="1929" class="Keyword">open</a> <a id="1934" class="Keyword">import</a> <a id="1941" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1958" class="Keyword">using</a> <a id="1964" class="Symbol">(</a><a id="1965" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="1967" class="Symbol">)</a>
<a id="1969" class="Keyword">open</a> <a id="1974" class="Keyword">import</a> <a id="1981" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="2007" class="Keyword">using</a> <a id="2013" class="Symbol">(</a><a id="2014" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#809" class="Function">contradiction</a><a id="2027" class="Symbol">)</a>
<a id="2029" class="Keyword">open</a> <a id="2034" class="Keyword">import</a> <a id="2041" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="2052" class="Keyword">using</a> <a id="2058" class="Symbol">(</a><a id="2059" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="2065" class="Symbol">)</a>
<a id="2067" class="Keyword">open</a> <a id="2072" class="Keyword">import</a> <a id="2079" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="2096" class="Keyword">using</a> <a id="2102" class="Symbol">(</a><a id="2103" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="2106" class="Symbol">;</a> <a id="2108" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="2111" class="Symbol">;</a> <a id="2113" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="2115" class="Symbol">)</a>
<a id="2117" class="Keyword">open</a> <a id="2122" class="Keyword">import</a> <a id="2129" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="2138" class="Keyword">using</a> <a id="2144" class="Symbol">(</a><a id="2145" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="2148" class="Symbol">)</a>
<a id="2150" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a>
</pre>
<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3216" class="Keyword">infix</a> <a id="3222" class="Number">3</a> <a id="3224" href="/Soundness/#3231" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3231" href="/Soundness/#3231" class="Function Operator">_`⊢_↓_</a> <a id="3238" class="Symbol">:</a> <a id="3240" class="Symbol">∀{</a><a id="3242" href="plfa.Soundness.html#3242" class="Bound">Δ</a> <a id="3244" href="plfa.Soundness.html#3244" class="Bound">Γ</a><a id="3245" class="Symbol">}</a> <a id="3247" class="Symbol">→</a> <a id="3249" href="/Denotational/#7096" class="Function">Env</a> <a id="3253" href="plfa.Soundness.html#3242" class="Bound">Δ</a> <a id="3255" class="Symbol">→</a> <a id="3257" href="/Substitution/#2431" class="Function">Subst</a> <a id="3263" href="plfa.Soundness.html#3244" class="Bound">Γ</a> <a id="3265" href="plfa.Soundness.html#3242" class="Bound">Δ</a> <a id="3267" class="Symbol">→</a> <a id="3269" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="3273" href="plfa.Soundness.html#3244" class="Bound">Γ</a> <a id="3275" class="Symbol">→</a> <a id="3277" class="PrimitiveType">Set</a>
<a id="3281" href="/Soundness/#3231" class="Function Operator">_`⊢_↓_</a> <a id="3288" class="Symbol">{</a><a id="3289" href="plfa.Soundness.html#3289" class="Bound">Δ</a><a id="3290" class="Symbol">}{</a><a id="3292" href="plfa.Soundness.html#3292" class="Bound">Γ</a><a id="3293" class="Symbol">}</a> <a id="3295" href="plfa.Soundness.html#3295" class="Bound">δ</a> <a id="3297" href="plfa.Soundness.html#3297" class="Bound">σ</a> <a id="3299" href="plfa.Soundness.html#3299" class="Bound">γ</a> <a id="3301" class="Symbol">=</a> <a id="3303" class="Symbol">(∀</a> <a id="3306" class="Symbol">(</a><a id="3307" href="plfa.Soundness.html#3307" class="Bound">x</a> <a id="3309" class="Symbol">:</a> <a id="3311" href="plfa.Soundness.html#3292" class="Bound">Γ</a> <a id="3313" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="3315" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="3316" class="Symbol">)</a> <a id="3318" class="Symbol">→</a> <a id="3320" href="plfa.Soundness.html#3295" class="Bound">δ</a> <a id="3322" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="3324" href="plfa.Soundness.html#3297" class="Bound">σ</a> <a id="3326" href="plfa.Soundness.html#3307" class="Bound">x</a> <a id="3328" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="3330" href="plfa.Soundness.html#3299" class="Bound">γ</a> <a id="3332" href="plfa.Soundness.html#3307" class="Bound">x</a><a id="3333" class="Symbol">)</a>
</pre>
<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3598" href="/Soundness/#3598" class="Function">subst-ext</a> <a id="3608" class="Symbol">:</a> <a id="3610" class="Symbol">∀</a> <a id="3612" class="Symbol">{</a><a id="3613" href="plfa.Soundness.html#3613" class="Bound">Γ</a> <a id="3615" href="plfa.Soundness.html#3615" class="Bound">Δ</a> <a id="3617" href="plfa.Soundness.html#3617" class="Bound">v</a><a id="3618" class="Symbol">}</a> <a id="3620" class="Symbol">{</a><a id="3621" href="plfa.Soundness.html#3621" class="Bound">γ</a> <a id="3623" class="Symbol">:</a> <a id="3625" href="/Denotational/#7096" class="Function">Env</a> <a id="3629" href="plfa.Soundness.html#3613" class="Bound">Γ</a><a id="3630" class="Symbol">}</a> <a id="3632" class="Symbol">{</a><a id="3633" href="plfa.Soundness.html#3633" class="Bound">δ</a> <a id="3635" class="Symbol">:</a> <a id="3637" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="3641" href="plfa.Soundness.html#3615" class="Bound">Δ</a><a id="3642" class="Symbol">}</a>
  <a id="3646" class="Symbol">→</a> <a id="3648" class="Symbol">(</a><a id="3649" href="/Soundness/#3649" class="Bound">σ</a> <a id="3651" class="Symbol">:</a> <a id="3653" href="/Substitution/#2431" class="Function">Subst</a> <a id="3659" href="plfa.Soundness.html#3613" class="Bound">Γ</a> <a id="3661" href="plfa.Soundness.html#3615" class="Bound">Δ</a><a id="3662" class="Symbol">)</a>
  <a id="3666" class="Symbol">→</a> <a id="3668" href="/Soundness/#3633" class="Bound">δ</a> <a id="3670" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="3673" href="plfa.Soundness.html#3649" class="Bound">σ</a> <a id="3675" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="3677" href="plfa.Soundness.html#3621" class="Bound">γ</a>
   <a id="3682" class="Comment">--------------------------</a>
  <a id="3711" class="Symbol">→</a> <a id="3713" href="/Soundness/#3633" class="Bound">δ</a> <a id="3715" href="/Denotational/#7253" class="Function Operator">`,</a> <a id="3718" href="plfa.Soundness.html#3617" class="Bound">v</a> <a id="3720" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="3723" href="/Untyped/#6405" class="Function">exts</a> <a id="3728" href="plfa.Soundness.html#3649" class="Bound">σ</a> <a id="3730" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="3732" href="plfa.Soundness.html#3621" class="Bound">γ</a> <a id="3734" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="3737" href="plfa.Soundness.html#3617" class="Bound">v</a>
<a id="3739" href="/Soundness/#3598" class="Function">subst-ext</a> <a id="3749" href="plfa.Soundness.html#3749" class="Bound">σ</a> <a id="3751" href="plfa.Soundness.html#3751" class="Bound">d</a> <a id="3753" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="3755" class="Symbol">=</a> <a id="3757" href="/Denotational/#9324" class="InductiveConstructor">var</a>
<a id="3761" href="/Soundness/#3598" class="Function">subst-ext</a> <a id="3771" href="plfa.Soundness.html#3771" class="Bound">σ</a> <a id="3773" href="plfa.Soundness.html#3773" class="Bound">d</a> <a id="3775" class="Symbol">(</a><a id="3776" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="3778" href="plfa.Soundness.html#3778" class="Bound">x′</a><a id="3780" class="Symbol">)</a> <a id="3782" class="Symbol">=</a> <a id="3784" href="/Denotational/#23412" class="Function">rename-pres</a> <a id="3796" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S_</a> <a id="3799" class="Symbol">(λ</a> <a id="3802" href="plfa.Soundness.html#3802" class="Bound">_</a> <a id="3804" class="Symbol">→</a> <a id="3806" href="plfa.Denotational.html#5467" class="Function">Refl⊑</a><a id="3811" class="Symbol">)</a> <a id="3813" class="Symbol">(</a><a id="3814" href="plfa.Soundness.html#3773" class="Bound">d</a> <a id="3816" href="plfa.Soundness.html#3778" class="Bound">x′</a><a id="3818" class="Symbol">)</a>
</pre>
<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x′</code>,then we need to show that
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4235" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4246" class="Symbol">:</a> <a id="4248" class="Symbol">∀</a> <a id="4250" class="Symbol">{</a><a id="4251" href="plfa.Soundness.html#4251" class="Bound">Γ</a> <a id="4253" href="plfa.Soundness.html#4253" class="Bound">Δ</a> <a id="4255" href="plfa.Soundness.html#4255" class="Bound">v</a><a id="4256" class="Symbol">}</a> <a id="4258" class="Symbol">{</a><a id="4259" href="plfa.Soundness.html#4259" class="Bound">γ</a> <a id="4261" class="Symbol">:</a> <a id="4263" href="/Denotational/#7096" class="Function">Env</a> <a id="4267" href="plfa.Soundness.html#4251" class="Bound">Γ</a><a id="4268" class="Symbol">}</a> <a id="4270" class="Symbol">{</a><a id="4271" href="plfa.Soundness.html#4271" class="Bound">δ</a> <a id="4273" class="Symbol">:</a> <a id="4275" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="4279" href="plfa.Soundness.html#4253" class="Bound">Δ</a><a id="4280" class="Symbol">}</a> <a id="4282" class="Symbol">{</a><a id="4283" href="plfa.Soundness.html#4283" class="Bound">M</a> <a id="4285" class="Symbol">:</a> <a id="4287" href="plfa.Soundness.html#4251" class="Bound">Γ</a> <a id="4289" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="4291" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="4292" class="Symbol">}</a>
  <a id="4296" class="Symbol">→</a> <a id="4298" class="Symbol">(</a><a id="4299" href="/Soundness/#4299" class="Bound">σ</a> <a id="4301" class="Symbol">:</a> <a id="4303" href="/Substitution/#2431" class="Function">Subst</a> <a id="4309" href="plfa.Soundness.html#4251" class="Bound">Γ</a> <a id="4311" href="plfa.Soundness.html#4253" class="Bound">Δ</a><a id="4312" class="Symbol">)</a>
  <a id="4316" class="Symbol">→</a> <a id="4318" href="/Soundness/#4271" class="Bound">δ</a> <a id="4320" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="4323" href="plfa.Soundness.html#4299" class="Bound">σ</a> <a id="4325" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="4327" href="plfa.Soundness.html#4259" class="Bound">γ</a>
  <a id="4331" class="Symbol">→</a> <a id="4333" href="/Soundness/#4259" class="Bound">γ</a> <a id="4335" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="4337" href="plfa.Soundness.html#4283" class="Bound">M</a> <a id="4339" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="4341" href="plfa.Soundness.html#4255" class="Bound">v</a>
    <a id="4347" class="Comment">------------------</a>
  <a id="4368" class="Symbol">→</a> <a id="4370" href="/Soundness/#4271" class="Bound">δ</a> <a id="4372" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="4374" href="/Untyped/#6697" class="Function">subst</a> <a id="4380" href="plfa.Soundness.html#4299" class="Bound">σ</a> <a id="4382" href="plfa.Soundness.html#4283" class="Bound">M</a> <a id="4384" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="4386" href="plfa.Soundness.html#4255" class="Bound">v</a>
<a id="4388" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4399" href="plfa.Soundness.html#4399" class="Bound">σ</a> <a id="4401" href="plfa.Soundness.html#4401" class="Bound">s</a> <a id="4403" class="Symbol">(</a><a id="4404" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="4408" class="Symbol">{</a><a id="4409" class="Argument">x</a> <a id="4411" class="Symbol">=</a> <a id="4413" href="plfa.Soundness.html#4413" class="Bound">x</a><a id="4414" class="Symbol">})</a> <a id="4417" class="Symbol">=</a> <a id="4419" class="Symbol">(</a><a id="4420" href="plfa.Soundness.html#4401" class="Bound">s</a> <a id="4422" href="plfa.Soundness.html#4413" class="Bound">x</a><a id="4423" class="Symbol">)</a>
<a id="4425" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4436" href="plfa.Soundness.html#4436" class="Bound">σ</a> <a id="4438" href="plfa.Soundness.html#4438" class="Bound">s</a> <a id="4440" class="Symbol">(</a><a id="4441" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="4448" href="plfa.Soundness.html#4448" class="Bound">d₁</a> <a id="4451" href="plfa.Soundness.html#4451" class="Bound">d₂</a><a id="4453" class="Symbol">)</a> <a id="4455" class="Symbol">=</a>
  <a id="4459" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="4466" class="Symbol">(</a><a id="4467" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4478" href="plfa.Soundness.html#4436" class="Bound">σ</a> <a id="4480" href="plfa.Soundness.html#4438" class="Bound">s</a> <a id="4482" href="plfa.Soundness.html#4448" class="Bound">d₁</a><a id="4484" class="Symbol">)</a> <a id="4486" class="Symbol">(</a><a id="4487" href="plfa.Soundness.html#4235" class="Function">subst-pres</a> <a id="4498" href="plfa.Soundness.html#4436" class="Bound">σ</a> <a id="4500" href="plfa.Soundness.html#4438" class="Bound">s</a> <a id="4502" href="plfa.Soundness.html#4451" class="Bound">d₂</a><a id="4504" class="Symbol">)</a>
<a id="4506" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4517" href="plfa.Soundness.html#4517" class="Bound">σ</a> <a id="4519" href="plfa.Soundness.html#4519" class="Bound">s</a> <a id="4521" class="Symbol">(</a><a id="4522" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="4530" href="plfa.Soundness.html#4530" class="Bound">d</a><a id="4531" class="Symbol">)</a> <a id="4533" class="Symbol">=</a>
  <a id="4537" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="4545" class="Symbol">(</a><a id="4546" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4557" class="Symbol">(λ</a> <a id="4560" class="Symbol">{</a><a id="4561" href="plfa.Soundness.html#4561" class="Bound">A</a><a id="4562" class="Symbol">}</a> <a id="4564" class="Symbol">→</a> <a id="4566" href="/Untyped/#6405" class="Function">exts</a> <a id="4571" href="plfa.Soundness.html#4517" class="Bound">σ</a><a id="4572" class="Symbol">)</a> <a id="4574" class="Symbol">(</a><a id="4575" href="plfa.Soundness.html#3598" class="Function">subst-ext</a> <a id="4585" href="plfa.Soundness.html#4517" class="Bound">σ</a> <a id="4587" href="plfa.Soundness.html#4519" class="Bound">s</a><a id="4588" class="Symbol">)</a> <a id="4590" href="plfa.Soundness.html#4530" class="Bound">d</a><a id="4591" class="Symbol">)</a>
<a id="4593" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4604" href="plfa.Soundness.html#4604" class="Bound">σ</a> <a id="4606" href="plfa.Soundness.html#4606" class="Bound">s</a> <a id="4608" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="4616" class="Symbol">=</a> <a id="4618" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a>
<a id="4626" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4637" href="plfa.Soundness.html#4637" class="Bound">σ</a> <a id="4639" href="plfa.Soundness.html#4639" class="Bound">s</a> <a id="4641" class="Symbol">(</a><a id="4642" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="4650" href="plfa.Soundness.html#4650" class="Bound">d₁</a> <a id="4653" href="plfa.Soundness.html#4653" class="Bound">d₂</a><a id="4655" class="Symbol">)</a> <a id="4657" class="Symbol">=</a>
  <a id="4661" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="4669" class="Symbol">(</a><a id="4670" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4681" href="plfa.Soundness.html#4637" class="Bound">σ</a> <a id="4683" href="plfa.Soundness.html#4639" class="Bound">s</a> <a id="4685" href="plfa.Soundness.html#4650" class="Bound">d₁</a><a id="4687" class="Symbol">)</a> <a id="4689" class="Symbol">(</a><a id="4690" href="plfa.Soundness.html#4235" class="Function">subst-pres</a> <a id="4701" href="plfa.Soundness.html#4637" class="Bound">σ</a> <a id="4703" href="plfa.Soundness.html#4639" class="Bound">s</a> <a id="4705" href="plfa.Soundness.html#4653" class="Bound">d₂</a><a id="4707" class="Symbol">)</a>
<a id="4709" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="4720" href="plfa.Soundness.html#4720" class="Bound">σ</a> <a id="4722" href="plfa.Soundness.html#4722" class="Bound">s</a> <a id="4724" class="Symbol">(</a><a id="4725" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="4729" href="plfa.Soundness.html#4729" class="Bound">d</a> <a id="4731" href="plfa.Soundness.html#4731" class="Bound">lt</a><a id="4733" class="Symbol">)</a> <a id="4735" class="Symbol">=</a> <a id="4737" href="plfa.Denotational.html#9871" class="InductiveConstructor">sub</a> <a id="4741" class="Symbol">(</a><a id="4742" href="plfa.Soundness.html#4235" class="Function">subst-pres</a> <a id="4753" href="plfa.Soundness.html#4720" class="Bound">σ</a> <a id="4755" href="plfa.Soundness.html#4722" class="Bound">s</a> <a id="4757" href="plfa.Soundness.html#4729" class="Bound">d</a><a id="4758" class="Symbol">)</a> <a id="4760" href="plfa.Soundness.html#4731" class="Bound">lt</a>
</pre>
<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5710" href="/Soundness/#5710" class="Function">substitution</a> <a id="5723" class="Symbol">:</a> <a id="5725" class="Symbol">∀</a> <a id="5727" class="Symbol">{</a><a id="5728" href="plfa.Soundness.html#5728" class="Bound">Γ</a><a id="5729" class="Symbol">}</a> <a id="5731" class="Symbol">{</a><a id="5732" href="plfa.Soundness.html#5732" class="Bound">γ</a> <a id="5734" class="Symbol">:</a> <a id="5736" href="/Denotational/#7096" class="Function">Env</a> <a id="5740" href="plfa.Soundness.html#5728" class="Bound">Γ</a><a id="5741" class="Symbol">}</a> <a id="5743" class="Symbol">{</a><a id="5744" href="plfa.Soundness.html#5744" class="Bound">N</a> <a id="5746" href="plfa.Soundness.html#5746" class="Bound">M</a> <a id="5748" href="plfa.Soundness.html#5748" class="Bound">v</a> <a id="5750" href="plfa.Soundness.html#5750" class="Bound">w</a><a id="5751" class="Symbol">}</a>
   <a id="5756" class="Symbol">→</a> <a id="5758" href="/Soundness/#5732" class="Bound">γ</a> <a id="5760" href="/Denotational/#7253" class="Function Operator">`,</a> <a id="5763" href="plfa.Soundness.html#5748" class="Bound">v</a> <a id="5765" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="5767" href="plfa.Soundness.html#5744" class="Bound">N</a> <a id="5769" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="5771" href="plfa.Soundness.html#5750" class="Bound">w</a>
   <a id="5776" class="Symbol">→</a> <a id="5778" href="/Soundness/#5732" class="Bound">γ</a> <a id="5780" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="5782" href="plfa.Soundness.html#5746" class="Bound">M</a> <a id="5784" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="5786" href="plfa.Soundness.html#5748" class="Bound">v</a>
     <a id="5793" class="Comment">---------------</a>
   <a id="5812" class="Symbol">→</a> <a id="5814" href="/Soundness/#5732" class="Bound">γ</a> <a id="5816" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="5818" href="plfa.Soundness.html#5744" class="Bound">N</a> <a id="5820" href="/Untyped/#7225" class="Function Operator">[</a> <a id="5822" href="plfa.Soundness.html#5746" class="Bound">M</a> <a id="5824" href="plfa.Untyped.html#7225" class="Function Operator">]</a> <a id="5826" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="5828" href="plfa.Soundness.html#5750" class="Bound">w</a>
<a id="5830" href="/Soundness/#5710" class="Function">substitution</a><a id="5842" class="Symbol">{</a><a id="5843" href="plfa.Soundness.html#5843" class="Bound">Γ</a><a id="5844" class="Symbol">}{</a><a id="5846" href="plfa.Soundness.html#5846" class="Bound">γ</a><a id="5847" class="Symbol">}{</a><a id="5849" href="plfa.Soundness.html#5849" class="Bound">N</a><a id="5850" class="Symbol">}{</a><a id="5852" href="plfa.Soundness.html#5852" class="Bound">M</a><a id="5853" class="Symbol">}{</a><a id="5855" href="plfa.Soundness.html#5855" class="Bound">v</a><a id="5856" class="Symbol">}{</a><a id="5858" href="plfa.Soundness.html#5858" class="Bound">w</a><a id="5859" class="Symbol">}</a> <a id="5861" href="plfa.Soundness.html#5861" class="Bound">dn</a> <a id="5864" href="plfa.Soundness.html#5864" class="Bound">dm</a> <a id="5867" class="Symbol">=</a>
  <a id="5871" href="/Soundness/#4235" class="Function">subst-pres</a> <a id="5882" class="Symbol">(</a><a id="5883" href="/Untyped/#7109" class="Function">subst-zero</a> <a id="5894" href="plfa.Soundness.html#5852" class="Bound">M</a><a id="5895" class="Symbol">)</a> <a id="5897" href="plfa.Soundness.html#5919" class="Function">sub-z-ok</a> <a id="5906" href="plfa.Soundness.html#5861" class="Bound">dn</a>
  <a id="5911" class="Keyword">where</a>
  <a id="5919" href="/Soundness/#5919" class="Function">sub-z-ok</a> <a id="5928" class="Symbol">:</a> <a id="5930" href="plfa.Soundness.html#5846" class="Bound">γ</a> <a id="5932" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="5935" href="/Untyped/#7109" class="Function">subst-zero</a> <a id="5946" href="plfa.Soundness.html#5852" class="Bound">M</a> <a id="5948" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="5950" class="Symbol">(</a><a id="5951" href="plfa.Soundness.html#5846" class="Bound">γ</a> <a id="5953" href="/Denotational/#7253" class="Function Operator">`,</a> <a id="5956" href="plfa.Soundness.html#5855" class="Bound">v</a><a id="5957" class="Symbol">)</a>
  <a id="5961" href="/Soundness/#5919" class="Function">sub-z-ok</a> <a id="5970" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="5972" class="Symbol">=</a> <a id="5974" href="plfa.Soundness.html#5864" class="Bound">dm</a>
  <a id="5979" href="/Soundness/#5919" class="Function">sub-z-ok</a> <a id="5988" class="Symbol">(</a><a id="5989" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="5991" href="plfa.Soundness.html#5991" class="Bound">x</a><a id="5992" class="Symbol">)</a> <a id="5994" class="Symbol">=</a> <a id="5996" href="/Denotational/#9324" class="InductiveConstructor">var</a>
</pre>
<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6673" href="/Soundness/#6673" class="Function">preserve</a> <a id="6682" class="Symbol">:</a> <a id="6684" class="Symbol">∀</a> <a id="6686" class="Symbol">{</a><a id="6687" href="plfa.Soundness.html#6687" class="Bound">Γ</a><a id="6688" class="Symbol">}</a> <a id="6690" class="Symbol">{</a><a id="6691" href="plfa.Soundness.html#6691" class="Bound">γ</a> <a id="6693" class="Symbol">:</a> <a id="6695" href="/Denotational/#7096" class="Function">Env</a> <a id="6699" href="plfa.Soundness.html#6687" class="Bound">Γ</a><a id="6700" class="Symbol">}</a> <a id="6702" class="Symbol">{</a><a id="6703" href="plfa.Soundness.html#6703" class="Bound">M</a> <a id="6705" href="plfa.Soundness.html#6705" class="Bound">N</a> <a id="6707" href="plfa.Soundness.html#6707" class="Bound">v</a><a id="6708" class="Symbol">}</a>
  <a id="6712" class="Symbol">→</a> <a id="6714" href="/Soundness/#6691" class="Bound">γ</a> <a id="6716" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="6718" href="plfa.Soundness.html#6703" class="Bound">M</a> <a id="6720" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="6722" href="plfa.Soundness.html#6707" class="Bound">v</a>
  <a id="6726" class="Symbol">→</a> <a id="6728" href="/Soundness/#6703" class="Bound">M</a> <a id="6730" href="/LambdaReduction/#345" class="Datatype Operator">—→</a> <a id="6733" href="plfa.Soundness.html#6705" class="Bound">N</a>
    <a id="6739" class="Comment">----------</a>
  <a id="6752" class="Symbol">→</a> <a id="6754" href="/Soundness/#6691" class="Bound">γ</a> <a id="6756" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="6758" href="plfa.Soundness.html#6705" class="Bound">N</a> <a id="6760" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="6762" href="plfa.Soundness.html#6707" class="Bound">v</a>
<a id="6764" href="/Soundness/#6673" class="Function">preserve</a> <a id="6773" class="Symbol">(</a><a id="6774" href="/Denotational/#9324" class="InductiveConstructor">var</a><a id="6777" class="Symbol">)</a> <a id="6779" class="Symbol">()</a>
<a id="6782" href="/Soundness/#6673" class="Function">preserve</a> <a id="6791" class="Symbol">(</a><a id="6792" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="6799" href="plfa.Soundness.html#6799" class="Bound">d₁</a> <a id="6802" href="plfa.Soundness.html#6802" class="Bound">d₂</a><a id="6804" class="Symbol">)</a> <a id="6806" class="Symbol">(</a><a id="6807" href="/LambdaReduction/#395" class="InductiveConstructor">ξ₁</a> <a id="6810" href="plfa.Soundness.html#6810" class="Bound">r</a><a id="6811" class="Symbol">)</a> <a id="6813" class="Symbol">=</a> <a id="6815" href="plfa.Denotational.html#9403" class="InductiveConstructor">↦-elim</a> <a id="6822" class="Symbol">(</a><a id="6823" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="6832" href="plfa.Soundness.html#6799" class="Bound">d₁</a> <a id="6835" href="plfa.Soundness.html#6810" class="Bound">r</a><a id="6836" class="Symbol">)</a> <a id="6838" href="plfa.Soundness.html#6802" class="Bound">d₂</a>
<a id="6841" href="/Soundness/#6673" class="Function">preserve</a> <a id="6850" class="Symbol">(</a><a id="6851" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="6858" href="plfa.Soundness.html#6858" class="Bound">d₁</a> <a id="6861" href="plfa.Soundness.html#6861" class="Bound">d₂</a><a id="6863" class="Symbol">)</a> <a id="6865" class="Symbol">(</a><a id="6866" href="/LambdaReduction/#485" class="InductiveConstructor">ξ₂</a> <a id="6869" href="plfa.Soundness.html#6869" class="Bound">r</a><a id="6870" class="Symbol">)</a> <a id="6872" class="Symbol">=</a> <a id="6874" href="plfa.Denotational.html#9403" class="InductiveConstructor">↦-elim</a> <a id="6881" href="plfa.Soundness.html#6858" class="Bound">d₁</a> <a id="6884" class="Symbol">(</a><a id="6885" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="6894" href="plfa.Soundness.html#6861" class="Bound">d₂</a> <a id="6897" href="plfa.Soundness.html#6869" class="Bound">r</a><a id="6898" class="Symbol">)</a>
<a id="6900" href="/Soundness/#6673" class="Function">preserve</a> <a id="6909" class="Symbol">(</a><a id="6910" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="6917" href="plfa.Soundness.html#6917" class="Bound">d₁</a> <a id="6920" href="plfa.Soundness.html#6920" class="Bound">d₂</a><a id="6922" class="Symbol">)</a> <a id="6924" href="/LambdaReduction/#575" class="InductiveConstructor">β</a> <a id="6926" class="Symbol">=</a> <a id="6928" href="plfa.Soundness.html#5710" class="Function">substitution</a> <a id="6941" class="Symbol">(</a><a id="6942" href="/Compositional/#3566" class="Function">lambda-inversion</a> <a id="6959" href="plfa.Soundness.html#6917" class="Bound">d₁</a><a id="6961" class="Symbol">)</a> <a id="6963" href="plfa.Soundness.html#6920" class="Bound">d₂</a>
<a id="6966" href="/Soundness/#6673" class="Function">preserve</a> <a id="6975" class="Symbol">(</a><a id="6976" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="6984" href="plfa.Soundness.html#6984" class="Bound">d</a><a id="6985" class="Symbol">)</a> <a id="6987" class="Symbol">(</a><a id="6988" href="/LambdaReduction/#683" class="InductiveConstructor">ζ</a> <a id="6990" href="plfa.Soundness.html#6990" class="Bound">r</a><a id="6991" class="Symbol">)</a> <a id="6993" class="Symbol">=</a> <a id="6995" href="plfa.Denotational.html#9541" class="InductiveConstructor">↦-intro</a> <a id="7003" class="Symbol">(</a><a id="7004" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="7013" href="plfa.Soundness.html#6984" class="Bound">d</a> <a id="7015" href="plfa.Soundness.html#6990" class="Bound">r</a><a id="7016" class="Symbol">)</a>
<a id="7018" href="/Soundness/#6673" class="Function">preserve</a> <a id="7027" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="7035" href="plfa.Soundness.html#7035" class="Bound">r</a> <a id="7037" class="Symbol">=</a> <a id="7039" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a>
<a id="7047" href="/Soundness/#6673" class="Function">preserve</a> <a id="7056" class="Symbol">(</a><a id="7057" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="7065" href="plfa.Soundness.html#7065" class="Bound">d</a> <a id="7067" href="plfa.Soundness.html#7067" class="Bound">d₁</a><a id="7069" class="Symbol">)</a> <a id="7071" href="plfa.Soundness.html#7071" class="Bound">r</a> <a id="7073" class="Symbol">=</a> <a id="7075" href="plfa.Denotational.html#9740" class="InductiveConstructor">⊔-intro</a> <a id="7083" class="Symbol">(</a><a id="7084" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="7093" href="plfa.Soundness.html#7065" class="Bound">d</a> <a id="7095" href="plfa.Soundness.html#7071" class="Bound">r</a><a id="7096" class="Symbol">)</a> <a id="7098" class="Symbol">(</a><a id="7099" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="7108" href="plfa.Soundness.html#7067" class="Bound">d₁</a> <a id="7111" href="plfa.Soundness.html#7071" class="Bound">r</a><a id="7112" class="Symbol">)</a>
<a id="7114" href="/Soundness/#6673" class="Function">preserve</a> <a id="7123" class="Symbol">(</a><a id="7124" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="7128" href="plfa.Soundness.html#7128" class="Bound">d</a> <a id="7130" href="plfa.Soundness.html#7130" class="Bound">lt</a><a id="7132" class="Symbol">)</a> <a id="7134" href="plfa.Soundness.html#7134" class="Bound">r</a> <a id="7136" class="Symbol">=</a> <a id="7138" href="plfa.Denotational.html#9871" class="InductiveConstructor">sub</a> <a id="7142" class="Symbol">(</a><a id="7143" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="7152" href="plfa.Soundness.html#7128" class="Bound">d</a> <a id="7154" href="plfa.Soundness.html#7134" class="Bound">r</a><a id="7155" class="Symbol">)</a> <a id="7157" href="plfa.Soundness.html#7130" class="Bound">lt</a>
</pre>
<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8847" href="/Soundness/#8847" class="Function">nth-ext</a> <a id="8855" class="Symbol">:</a> <a id="8857" class="Symbol">∀</a> <a id="8859" class="Symbol">{</a><a id="8860" href="plfa.Soundness.html#8860" class="Bound">Γ</a> <a id="8862" href="plfa.Soundness.html#8862" class="Bound">Δ</a> <a id="8864" href="plfa.Soundness.html#8864" class="Bound">v</a><a id="8865" class="Symbol">}</a> <a id="8867" class="Symbol">{</a><a id="8868" href="plfa.Soundness.html#8868" class="Bound">γ</a> <a id="8870" class="Symbol">:</a> <a id="8872" href="/Denotational/#7096" class="Function">Env</a> <a id="8876" href="plfa.Soundness.html#8860" class="Bound">Γ</a><a id="8877" class="Symbol">}</a> <a id="8879" class="Symbol">{</a><a id="8880" href="plfa.Soundness.html#8880" class="Bound">δ</a> <a id="8882" class="Symbol">:</a> <a id="8884" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="8888" href="plfa.Soundness.html#8862" class="Bound">Δ</a><a id="8889" class="Symbol">}</a>
  <a id="8893" class="Symbol">→</a> <a id="8895" class="Symbol">(</a><a id="8896" href="/Soundness/#8896" class="Bound">ρ</a> <a id="8898" class="Symbol">:</a> <a id="8900" href="/Substitution/#2218" class="Function">Rename</a> <a id="8907" href="plfa.Soundness.html#8860" class="Bound">Γ</a> <a id="8909" href="plfa.Soundness.html#8862" class="Bound">Δ</a><a id="8910" class="Symbol">)</a>
  <a id="8914" class="Symbol">→</a> <a id="8916" class="Symbol">(</a><a id="8917" href="/Soundness/#8880" class="Bound">δ</a> <a id="8919" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8921" href="plfa.Soundness.html#8896" class="Bound">ρ</a><a id="8922" class="Symbol">)</a> <a id="8924" href="/Denotational/#8058" class="Function Operator">`⊑</a> <a id="8927" href="plfa.Soundness.html#8868" class="Bound">γ</a>
    <a id="8933" class="Comment">------------------------------</a>
  <a id="8966" class="Symbol">→</a> <a id="8968" class="Symbol">((</a><a id="8970" href="/Soundness/#8880" class="Bound">δ</a> <a id="8972" href="/Denotational/#7253" class="Function Operator">`,</a> <a id="8975" href="plfa.Soundness.html#8864" class="Bound">v</a><a id="8976" class="Symbol">)</a> <a id="8978" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8980" href="/Untyped/#5659" class="Function">ext</a> <a id="8984" href="plfa.Soundness.html#8896" class="Bound">ρ</a><a id="8985" class="Symbol">)</a> <a id="8987" href="plfa.Denotational.html#8058" class="Function Operator">`⊑</a> <a id="8990" class="Symbol">(</a><a id="8991" href="plfa.Soundness.html#8868" class="Bound">γ</a> <a id="8993" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="8996" href="plfa.Soundness.html#8864" class="Bound">v</a><a id="8997" class="Symbol">)</a>
<a id="8999" href="/Soundness/#8847" class="Function">nth-ext</a> <a id="9007" href="plfa.Soundness.html#9007" class="Bound">ρ</a> <a id="9009" href="plfa.Soundness.html#9009" class="Bound">lt</a> <a id="9012" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="9014" class="Symbol">=</a> <a id="9016" href="/Denotational/#5467" class="Function">Refl⊑</a>
<a id="9022" href="/Soundness/#8847" class="Function">nth-ext</a> <a id="9030" href="plfa.Soundness.html#9030" class="Bound">ρ</a> <a id="9032" href="plfa.Soundness.html#9032" class="Bound">lt</a> <a id="9035" class="Symbol">(</a><a id="9036" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="9038" href="plfa.Soundness.html#9038" class="Bound">x</a><a id="9039" class="Symbol">)</a> <a id="9041" class="Symbol">=</a> <a id="9043" href="plfa.Soundness.html#9032" class="Bound">lt</a> <a id="9046" href="plfa.Soundness.html#9038" class="Bound">x</a>
</pre>
<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9087" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9102" class="Symbol">:</a> <a id="9104" class="Symbol">∀</a> <a id="9106" class="Symbol">{</a><a id="9107" href="plfa.Soundness.html#9107" class="Bound">Γ</a> <a id="9109" href="plfa.Soundness.html#9109" class="Bound">Δ</a> <a id="9111" href="plfa.Soundness.html#9111" class="Bound">v</a><a id="9112" class="Symbol">}</a> <a id="9114" class="Symbol">{</a><a id="9115" href="plfa.Soundness.html#9115" class="Bound">γ</a> <a id="9117" class="Symbol">:</a> <a id="9119" href="/Denotational/#7096" class="Function">Env</a> <a id="9123" href="plfa.Soundness.html#9107" class="Bound">Γ</a><a id="9124" class="Symbol">}</a> <a id="9126" class="Symbol">{</a><a id="9127" href="plfa.Soundness.html#9127" class="Bound">δ</a> <a id="9129" class="Symbol">:</a> <a id="9131" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="9135" href="plfa.Soundness.html#9109" class="Bound">Δ</a><a id="9136" class="Symbol">}</a> <a id="9138" class="Symbol">{</a> <a id="9140" href="plfa.Soundness.html#9140" class="Bound">M</a> <a id="9142" class="Symbol">:</a> <a id="9144" href="plfa.Soundness.html#9107" class="Bound">Γ</a> <a id="9146" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="9148" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="9149" class="Symbol">}</a>
  <a id="9153" class="Symbol">→</a> <a id="9155" class="Symbol">{</a><a id="9156" href="/Soundness/#9156" class="Bound">ρ</a> <a id="9158" class="Symbol">:</a> <a id="9160" href="/Substitution/#2218" class="Function">Rename</a> <a id="9167" href="plfa.Soundness.html#9107" class="Bound">Γ</a> <a id="9169" href="plfa.Soundness.html#9109" class="Bound">Δ</a><a id="9170" class="Symbol">}</a>
  <a id="9174" class="Symbol">→</a> <a id="9176" class="Symbol">(</a><a id="9177" href="/Soundness/#9127" class="Bound">δ</a> <a id="9179" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="9181" href="plfa.Soundness.html#9156" class="Bound">ρ</a><a id="9182" class="Symbol">)</a> <a id="9184" href="/Denotational/#8058" class="Function Operator">`⊑</a> <a id="9187" href="plfa.Soundness.html#9115" class="Bound">γ</a>
  <a id="9191" class="Symbol">→</a> <a id="9193" href="/Soundness/#9127" class="Bound">δ</a> <a id="9195" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="9197" href="/Untyped/#5969" class="Function">rename</a> <a id="9204" href="plfa.Soundness.html#9156" class="Bound">ρ</a> <a id="9206" href="plfa.Soundness.html#9140" class="Bound">M</a> <a id="9208" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="9210" href="plfa.Soundness.html#9111" class="Bound">v</a>
    <a id="9216" class="Comment">------------------------------------</a>
  <a id="9255" class="Symbol">→</a> <a id="9257" href="/Soundness/#9115" class="Bound">γ</a> <a id="9259" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="9261" href="plfa.Soundness.html#9140" class="Bound">M</a> <a id="9263" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="9265" href="plfa.Soundness.html#9111" class="Bound">v</a>
<a id="9267" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9282" class="Symbol">{</a><a id="9283" class="Argument">M</a> <a id="9285" class="Symbol">=</a> <a id="9287" href="/Untyped/#4064" class="InductiveConstructor Operator">`</a> <a id="9289" href="plfa.Soundness.html#9289" class="Bound">x</a><a id="9290" class="Symbol">}</a> <a id="9292" href="plfa.Soundness.html#9292" class="Bound">all-n</a> <a id="9298" href="plfa.Soundness.html#9298" class="Bound">d</a> <a id="9300" class="Keyword">with</a> <a id="9305" href="/Compositional/#9665" class="Function">var-inv</a> <a id="9313" href="plfa.Soundness.html#9298" class="Bound">d</a>
<a id="9315" class="Symbol">...</a> <a id="9319" class="Symbol">|</a> <a id="9321" href="/Soundness/#9321" class="Bound">lt</a> <a id="9324" class="Symbol">=</a>  <a id="9327" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="9331" href="plfa.Denotational.html#9324" class="InductiveConstructor">var</a> <a id="9335" class="Symbol">(</a><a id="9336" href="plfa.Denotational.html#4610" class="InductiveConstructor">Trans⊑</a> <a id="9343" href="plfa.Soundness.html#9321" class="Bound">lt</a> <a id="9346" class="Symbol">(</a><a id="9347" class="Bound">all-n</a> <a id="9353" class="Bound">x</a><a id="9354" class="Symbol">))</a>
<a id="9357" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9372" class="Symbol">{</a><a id="9373" class="Argument">M</a> <a id="9375" class="Symbol">=</a> <a id="9377" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="9379" href="plfa.Soundness.html#9379" class="Bound">N</a><a id="9380" class="Symbol">}{</a><a id="9382" class="Argument">ρ</a> <a id="9384" class="Symbol">=</a> <a id="9386" href="plfa.Soundness.html#9386" class="Bound">ρ</a><a id="9387" class="Symbol">}</a> <a id="9389" href="plfa.Soundness.html#9389" class="Bound">all-n</a> <a id="9395" class="Symbol">(</a><a id="9396" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="9404" href="plfa.Soundness.html#9404" class="Bound">d</a><a id="9405" class="Symbol">)</a> <a id="9407" class="Symbol">=</a>
   <a id="9412" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="9420" class="Symbol">(</a><a id="9421" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9436" class="Symbol">(</a><a id="9437" href="plfa.Soundness.html#8847" class="Function">nth-ext</a> <a id="9445" href="plfa.Soundness.html#9386" class="Bound">ρ</a> <a id="9447" href="plfa.Soundness.html#9389" class="Bound">all-n</a><a id="9452" class="Symbol">)</a> <a id="9454" href="plfa.Soundness.html#9404" class="Bound">d</a><a id="9455" class="Symbol">)</a>
<a id="9457" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9472" class="Symbol">{</a><a id="9473" class="Argument">M</a> <a id="9475" class="Symbol">=</a> <a id="9477" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="9479" href="plfa.Soundness.html#9479" class="Bound">N</a><a id="9480" class="Symbol">}</a> <a id="9482" href="plfa.Soundness.html#9482" class="Bound">all-n</a> <a id="9488" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="9496" class="Symbol">=</a> <a id="9498" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a>
<a id="9506" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9521" class="Symbol">{</a><a id="9522" class="Argument">M</a> <a id="9524" class="Symbol">=</a> <a id="9526" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="9528" href="plfa.Soundness.html#9528" class="Bound">N</a><a id="9529" class="Symbol">}</a> <a id="9531" href="plfa.Soundness.html#9531" class="Bound">all-n</a> <a id="9537" class="Symbol">(</a><a id="9538" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="9546" href="plfa.Soundness.html#9546" class="Bound">d₁</a> <a id="9549" href="plfa.Soundness.html#9549" class="Bound">d₂</a><a id="9551" class="Symbol">)</a> <a id="9553" class="Symbol">=</a>
   <a id="9558" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="9566" class="Symbol">(</a><a id="9567" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9582" href="plfa.Soundness.html#9531" class="Bound">all-n</a> <a id="9588" href="plfa.Soundness.html#9546" class="Bound">d₁</a><a id="9590" class="Symbol">)</a> <a id="9592" class="Symbol">(</a><a id="9593" href="plfa.Soundness.html#9087" class="Function">rename-reflect</a> <a id="9608" href="plfa.Soundness.html#9531" class="Bound">all-n</a> <a id="9614" href="plfa.Soundness.html#9549" class="Bound">d₂</a><a id="9616" class="Symbol">)</a>
<a id="9618" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9633" class="Symbol">{</a><a id="9634" class="Argument">M</a> <a id="9636" class="Symbol">=</a> <a id="9638" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="9640" href="plfa.Soundness.html#9640" class="Bound">N</a><a id="9641" class="Symbol">}</a> <a id="9643" href="plfa.Soundness.html#9643" class="Bound">all-n</a> <a id="9649" class="Symbol">(</a><a id="9650" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="9654" href="plfa.Soundness.html#9654" class="Bound">d₁</a> <a id="9657" href="plfa.Soundness.html#9657" class="Bound">lt</a><a id="9659" class="Symbol">)</a> <a id="9661" class="Symbol">=</a>
   <a id="9666" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="9670" class="Symbol">(</a><a id="9671" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9686" href="plfa.Soundness.html#9643" class="Bound">all-n</a> <a id="9692" href="plfa.Soundness.html#9654" class="Bound">d₁</a><a id="9694" class="Symbol">)</a> <a id="9696" href="plfa.Soundness.html#9657" class="Bound">lt</a>
<a id="9699" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9714" class="Symbol">{</a><a id="9715" class="Argument">M</a> <a id="9717" class="Symbol">=</a> <a id="9719" href="plfa.Soundness.html#9719" class="Bound">L</a> <a id="9721" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="9723" href="plfa.Soundness.html#9723" class="Bound">M</a><a id="9724" class="Symbol">}</a> <a id="9726" href="plfa.Soundness.html#9726" class="Bound">all-n</a> <a id="9732" class="Symbol">(</a><a id="9733" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="9740" href="plfa.Soundness.html#9740" class="Bound">d₁</a> <a id="9743" href="plfa.Soundness.html#9743" class="Bound">d₂</a><a id="9745" class="Symbol">)</a> <a id="9747" class="Symbol">=</a>
   <a id="9752" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="9759" class="Symbol">(</a><a id="9760" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9775" href="plfa.Soundness.html#9726" class="Bound">all-n</a> <a id="9781" href="plfa.Soundness.html#9740" class="Bound">d₁</a><a id="9783" class="Symbol">)</a> <a id="9785" class="Symbol">(</a><a id="9786" href="plfa.Soundness.html#9087" class="Function">rename-reflect</a> <a id="9801" href="plfa.Soundness.html#9726" class="Bound">all-n</a> <a id="9807" href="plfa.Soundness.html#9743" class="Bound">d₂</a><a id="9809" class="Symbol">)</a>
<a id="9811" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9826" class="Symbol">{</a><a id="9827" class="Argument">M</a> <a id="9829" class="Symbol">=</a> <a id="9831" href="plfa.Soundness.html#9831" class="Bound">L</a> <a id="9833" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="9835" href="plfa.Soundness.html#9835" class="Bound">M</a><a id="9836" class="Symbol">}</a> <a id="9838" href="plfa.Soundness.html#9838" class="Bound">all-n</a> <a id="9844" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="9852" class="Symbol">=</a> <a id="9854" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a>
<a id="9862" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9877" class="Symbol">{</a><a id="9878" class="Argument">M</a> <a id="9880" class="Symbol">=</a> <a id="9882" href="plfa.Soundness.html#9882" class="Bound">L</a> <a id="9884" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="9886" href="plfa.Soundness.html#9886" class="Bound">M</a><a id="9887" class="Symbol">}</a> <a id="9889" href="plfa.Soundness.html#9889" class="Bound">all-n</a> <a id="9895" class="Symbol">(</a><a id="9896" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="9904" href="plfa.Soundness.html#9904" class="Bound">d₁</a> <a id="9907" href="plfa.Soundness.html#9907" class="Bound">d₂</a><a id="9909" class="Symbol">)</a> <a id="9911" class="Symbol">=</a>
   <a id="9916" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="9924" class="Symbol">(</a><a id="9925" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9940" href="plfa.Soundness.html#9889" class="Bound">all-n</a> <a id="9946" href="plfa.Soundness.html#9904" class="Bound">d₁</a><a id="9948" class="Symbol">)</a> <a id="9950" class="Symbol">(</a><a id="9951" href="plfa.Soundness.html#9087" class="Function">rename-reflect</a> <a id="9966" href="plfa.Soundness.html#9889" class="Bound">all-n</a> <a id="9972" href="plfa.Soundness.html#9907" class="Bound">d₂</a><a id="9974" class="Symbol">)</a>
<a id="9976" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="9991" class="Symbol">{</a><a id="9992" class="Argument">M</a> <a id="9994" class="Symbol">=</a> <a id="9996" href="plfa.Soundness.html#9996" class="Bound">L</a> <a id="9998" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="10000" href="plfa.Soundness.html#10000" class="Bound">M</a><a id="10001" class="Symbol">}</a> <a id="10003" href="plfa.Soundness.html#10003" class="Bound">all-n</a> <a id="10009" class="Symbol">(</a><a id="10010" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="10014" href="plfa.Soundness.html#10014" class="Bound">d₁</a> <a id="10017" href="plfa.Soundness.html#10017" class="Bound">lt</a><a id="10019" class="Symbol">)</a> <a id="10021" class="Symbol">=</a>
   <a id="10026" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="10030" class="Symbol">(</a><a id="10031" href="/Soundness/#9087" class="Function">rename-reflect</a> <a id="10046" href="plfa.Soundness.html#10003" class="Bound">all-n</a> <a id="10052" href="plfa.Soundness.html#10014" class="Bound">d₁</a><a id="10054" class="Symbol">)</a> <a id="10056" href="plfa.Soundness.html#10017" class="Bound">lt</a>
</pre>
<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11221" href="/Soundness/#11221" class="Function">rename-inc-reflect</a> <a id="11240" class="Symbol">:</a> <a id="11242" class="Symbol">∀</a> <a id="11244" class="Symbol">{</a><a id="11245" href="plfa.Soundness.html#11245" class="Bound">Γ</a> <a id="11247" href="plfa.Soundness.html#11247" class="Bound">v′</a> <a id="11250" href="plfa.Soundness.html#11250" class="Bound">v</a><a id="11251" class="Symbol">}</a> <a id="11253" class="Symbol">{</a><a id="11254" href="plfa.Soundness.html#11254" class="Bound">γ</a> <a id="11256" class="Symbol">:</a> <a id="11258" href="/Denotational/#7096" class="Function">Env</a> <a id="11262" href="plfa.Soundness.html#11245" class="Bound">Γ</a><a id="11263" class="Symbol">}</a> <a id="11265" class="Symbol">{</a> <a id="11267" href="plfa.Soundness.html#11267" class="Bound">M</a> <a id="11269" class="Symbol">:</a> <a id="11271" href="plfa.Soundness.html#11245" class="Bound">Γ</a> <a id="11273" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="11275" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="11276" class="Symbol">}</a>
  <a id="11280" class="Symbol">→</a> <a id="11282" class="Symbol">(</a><a id="11283" href="/Soundness/#11254" class="Bound">γ</a> <a id="11285" href="/Denotational/#7253" class="Function Operator">`,</a> <a id="11288" href="plfa.Soundness.html#11247" class="Bound">v′</a><a id="11290" class="Symbol">)</a> <a id="11292" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="11294" href="/Untyped/#5969" class="Function">rename</a> <a id="11301" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S_</a> <a id="11304" href="plfa.Soundness.html#11267" class="Bound">M</a> <a id="11306" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="11308" href="plfa.Soundness.html#11250" class="Bound">v</a>
    <a id="11314" class="Comment">----------------------------</a>
  <a id="11345" class="Symbol">→</a> <a id="11347" href="/Soundness/#11254" class="Bound">γ</a> <a id="11349" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="11351" href="plfa.Soundness.html#11267" class="Bound">M</a> <a id="11353" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="11355" href="plfa.Soundness.html#11250" class="Bound">v</a>
<a id="11357" href="/Soundness/#11221" class="Function">rename-inc-reflect</a> <a id="11376" href="plfa.Soundness.html#11376" class="Bound">d</a> <a id="11378" class="Symbol">=</a> <a id="11380" href="plfa.Soundness.html#9087" class="Function">rename-reflect</a> <a id="11395" href="/Denotational/#8544" class="Function">`Refl⊑</a> <a id="11402" href="plfa.Soundness.html#11376" class="Bound">d</a>
</pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>. To tell variables apart, we
define the following function for deciding equality of variables.</p>

<pre class="Agda"><a id="_var≟_"></a><a id="12124" href="/Soundness/#12124" class="Function Operator">_var≟_</a> <a id="12131" class="Symbol">:</a> <a id="12133" class="Symbol">∀</a> <a id="12135" class="Symbol">{</a><a id="12136" href="plfa.Soundness.html#12136" class="Bound">Γ</a><a id="12137" class="Symbol">}</a> <a id="12139" class="Symbol">→</a> <a id="12141" class="Symbol">(</a><a id="12142" href="plfa.Soundness.html#12142" class="Bound">x</a> <a id="12144" href="plfa.Soundness.html#12144" class="Bound">y</a> <a id="12146" class="Symbol">:</a> <a id="12148" href="plfa.Soundness.html#12136" class="Bound">Γ</a> <a id="12150" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="12152" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="12153" class="Symbol">)</a> <a id="12155" class="Symbol">→</a> <a id="12157" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a> <a id="12161" class="Symbol">(</a><a id="12162" href="plfa.Soundness.html#12142" class="Bound">x</a> <a id="12164" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12166" href="plfa.Soundness.html#12144" class="Bound">y</a><a id="12167" class="Symbol">)</a>
<a id="12169" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="12171" href="/Soundness/#12124" class="Function Operator">var≟</a> <a id="12176" href="plfa.Untyped.html#3295" class="InductiveConstructor">Z</a>  <a id="12179" class="Symbol">=</a>  <a id="12182" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12186" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12191" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="12193" href="/Soundness/#12124" class="Function Operator">var≟</a> <a id="12198" class="Symbol">(</a><a id="12199" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S</a> <a id="12201" class="Symbol">_)</a>  <a id="12205" class="Symbol">=</a>  <a id="12208" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12211" class="Symbol">λ()</a>
<a id="12215" class="Symbol">(</a><a id="12216" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="12218" class="Symbol">_)</a> <a id="12221" href="/Soundness/#12124" class="Function Operator">var≟</a> <a id="12226" href="plfa.Untyped.html#3295" class="InductiveConstructor">Z</a>  <a id="12229" class="Symbol">=</a>  <a id="12232" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12235" class="Symbol">λ()</a>
<a id="12239" class="Symbol">(</a><a id="12240" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="12242" href="/Soundness/#12242" class="Bound">x</a><a id="12243" class="Symbol">)</a> <a id="12245" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="12250" class="Symbol">(</a><a id="12251" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S</a> <a id="12253" href="plfa.Soundness.html#12253" class="Bound">y</a><a id="12254" class="Symbol">)</a> <a id="12256" class="Keyword">with</a>  <a id="12262" href="plfa.Soundness.html#12242" class="Bound">x</a> <a id="12264" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="12269" href="plfa.Soundness.html#12253" class="Bound">y</a>
<a id="12271" class="Symbol">...</a>                 <a id="12291" class="Symbol">|</a>  <a id="12294" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12298" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12303" class="Symbol">=</a>  <a id="12306" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12310" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12315" class="Symbol">...</a>                 <a id="12335" class="Symbol">|</a>  <a id="12338" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12341" href="/Soundness/#12341" class="Bound">neq</a>   <a id="12347" class="Symbol">=</a>  <a id="12350" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12353" class="Symbol">λ{</a><a id="12355" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12360" class="Symbol">→</a> <a id="12362" href="plfa.Soundness.html#12341" class="Bound">neq</a> <a id="12366" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="12370" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12373" href="/Soundness/#12373" class="Function">var≟-refl</a> <a id="12383" class="Symbol">:</a> <a id="12385" class="Symbol">∀</a> <a id="12387" class="Symbol">{</a><a id="12388" href="plfa.Soundness.html#12388" class="Bound">Γ</a><a id="12389" class="Symbol">}</a> <a id="12391" class="Symbol">(</a><a id="12392" href="plfa.Soundness.html#12392" class="Bound">x</a> <a id="12394" class="Symbol">:</a> <a id="12396" href="plfa.Soundness.html#12388" class="Bound">Γ</a> <a id="12398" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="12400" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="12401" class="Symbol">)</a> <a id="12403" class="Symbol">→</a> <a id="12405" class="Symbol">(</a><a id="12406" href="plfa.Soundness.html#12392" class="Bound">x</a> <a id="12408" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="12413" href="plfa.Soundness.html#12392" class="Bound">x</a><a id="12414" class="Symbol">)</a> <a id="12416" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12418" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12422" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12427" href="/Soundness/#12373" class="Function">var≟-refl</a> <a id="12437" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="12439" class="Symbol">=</a> <a id="12441" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12446" href="/Soundness/#12373" class="Function">var≟-refl</a> <a id="12456" class="Symbol">(</a><a id="12457" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="12459" href="plfa.Soundness.html#12459" class="Bound">x</a><a id="12460" class="Symbol">)</a> <a id="12462" class="Keyword">rewrite</a> <a id="12470" href="plfa.Soundness.html#12373" class="Function">var≟-refl</a> <a id="12480" href="plfa.Soundness.html#12459" class="Bound">x</a> <a id="12482" class="Symbol">=</a> <a id="12484" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>Now we use <code class="highlighter-rouge">var≟</code> to define <code class="highlighter-rouge">const-env</code>.</p>

<pre class="Agda"><a id="const-env"></a><a id="12540" href="/Soundness/#12540" class="Function">const-env</a> <a id="12550" class="Symbol">:</a> <a id="12552" class="Symbol">∀{</a><a id="12554" href="plfa.Soundness.html#12554" class="Bound">Γ</a><a id="12555" class="Symbol">}</a> <a id="12557" class="Symbol">→</a> <a id="12559" class="Symbol">(</a><a id="12560" href="plfa.Soundness.html#12560" class="Bound">x</a> <a id="12562" class="Symbol">:</a> <a id="12564" href="plfa.Soundness.html#12554" class="Bound">Γ</a> <a id="12566" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="12568" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="12569" class="Symbol">)</a> <a id="12571" class="Symbol">→</a> <a id="12573" href="/Denotational/#3958" class="Datatype">Value</a> <a id="12579" class="Symbol">→</a> <a id="12581" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="12585" href="plfa.Soundness.html#12554" class="Bound">Γ</a>
<a id="12587" href="/Soundness/#12540" class="Function">const-env</a> <a id="12597" href="plfa.Soundness.html#12597" class="Bound">x</a> <a id="12599" href="plfa.Soundness.html#12599" class="Bound">v</a> <a id="12601" href="plfa.Soundness.html#12601" class="Bound">y</a> <a id="12603" class="Keyword">with</a> <a id="12608" href="plfa.Soundness.html#12597" class="Bound">x</a> <a id="12610" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="12615" href="plfa.Soundness.html#12601" class="Bound">y</a>
<a id="12617" class="Symbol">...</a>             <a id="12633" class="Symbol">|</a> <a id="12635" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12639" class="Symbol">_</a>       <a id="12647" class="Symbol">=</a> <a id="12649" class="Bound">v</a>
<a id="12651" class="Symbol">...</a>             <a id="12667" class="Symbol">|</a> <a id="12669" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12672" class="Symbol">_</a>        <a id="12681" class="Symbol">=</a> <a id="12683" href="/Denotational/#3978" class="InductiveConstructor">⊥</a>
</pre>
<p>Of course, <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">x</code> to value <code class="highlighter-rouge">v</code></p>

<pre class="Agda"><a id="same-const-env"></a><a id="12744" href="/Soundness/#12744" class="Function">same-const-env</a> <a id="12759" class="Symbol">:</a> <a id="12761" class="Symbol">∀{</a><a id="12763" href="plfa.Soundness.html#12763" class="Bound">Γ</a><a id="12764" class="Symbol">}</a> <a id="12766" class="Symbol">{</a><a id="12767" href="plfa.Soundness.html#12767" class="Bound">x</a> <a id="12769" class="Symbol">:</a> <a id="12771" href="plfa.Soundness.html#12763" class="Bound">Γ</a> <a id="12773" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="12775" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="12776" class="Symbol">}</a> <a id="12778" class="Symbol">{</a><a id="12779" href="plfa.Soundness.html#12779" class="Bound">v</a><a id="12780" class="Symbol">}</a> <a id="12782" class="Symbol">→</a> <a id="12784" class="Symbol">(</a><a id="12785" href="plfa.Soundness.html#12540" class="Function">const-env</a> <a id="12795" href="plfa.Soundness.html#12767" class="Bound">x</a> <a id="12797" href="plfa.Soundness.html#12779" class="Bound">v</a><a id="12798" class="Symbol">)</a> <a id="12800" href="plfa.Soundness.html#12767" class="Bound">x</a> <a id="12802" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12804" href="plfa.Soundness.html#12779" class="Bound">v</a>
<a id="12806" href="/Soundness/#12744" class="Function">same-const-env</a> <a id="12821" class="Symbol">{</a><a id="12822" class="Argument">x</a> <a id="12824" class="Symbol">=</a> <a id="12826" href="plfa.Soundness.html#12826" class="Bound">x</a><a id="12827" class="Symbol">}</a> <a id="12829" class="Keyword">rewrite</a> <a id="12837" href="plfa.Soundness.html#12373" class="Function">var≟-refl</a> <a id="12847" href="plfa.Soundness.html#12826" class="Bound">x</a> <a id="12849" class="Symbol">=</a> <a id="12851" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>and <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">y</code> to <code class="highlighter-rouge">⊥, so long as </code>x ≢ y`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12922" href="/Soundness/#12922" class="Function">diff-nth-const-env</a> <a id="12941" class="Symbol">:</a> <a id="12943" class="Symbol">∀{</a><a id="12945" href="plfa.Soundness.html#12945" class="Bound">Γ</a><a id="12946" class="Symbol">}</a> <a id="12948" class="Symbol">{</a><a id="12949" href="plfa.Soundness.html#12949" class="Bound">x</a> <a id="12951" href="plfa.Soundness.html#12951" class="Bound">y</a> <a id="12953" class="Symbol">:</a> <a id="12955" href="plfa.Soundness.html#12945" class="Bound">Γ</a> <a id="12957" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="12959" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="12960" class="Symbol">}</a> <a id="12962" class="Symbol">{</a><a id="12963" href="plfa.Soundness.html#12963" class="Bound">v</a><a id="12964" class="Symbol">}</a>
  <a id="12968" class="Symbol">→</a> <a id="12970" href="/Soundness/#12949" class="Bound">x</a> <a id="12972" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="12974" href="plfa.Soundness.html#12951" class="Bound">y</a>
    <a id="12980" class="Comment">-------------------</a>
  <a id="13002" class="Symbol">→</a> <a id="13004" href="/Soundness/#12540" class="Function">const-env</a> <a id="13014" href="plfa.Soundness.html#12949" class="Bound">x</a> <a id="13016" href="plfa.Soundness.html#12963" class="Bound">v</a> <a id="13018" href="plfa.Soundness.html#12951" class="Bound">y</a> <a id="13020" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="13022" href="/Denotational/#3978" class="InductiveConstructor">⊥</a>
<a id="13024" href="/Soundness/#12922" class="Function">diff-nth-const-env</a> <a id="13043" class="Symbol">{</a><a id="13044" href="plfa.Soundness.html#13044" class="Bound">Γ</a><a id="13045" class="Symbol">}</a> <a id="13047" class="Symbol">{</a><a id="13048" href="plfa.Soundness.html#13048" class="Bound">x</a><a id="13049" class="Symbol">}</a> <a id="13051" class="Symbol">{</a><a id="13052" href="plfa.Soundness.html#13052" class="Bound">y</a><a id="13053" class="Symbol">}</a> <a id="13055" href="plfa.Soundness.html#13055" class="Bound">neq</a> <a id="13059" class="Keyword">with</a> <a id="13064" href="plfa.Soundness.html#13048" class="Bound">x</a> <a id="13066" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="13071" href="plfa.Soundness.html#13052" class="Bound">y</a>
<a id="13073" class="Symbol">...</a>  <a id="13078" class="Symbol">|</a> <a id="13080" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="13084" href="/Soundness/#13084" class="Bound">eq</a>  <a id="13088" class="Symbol">=</a>  <a id="13091" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="13098" class="Symbol">(</a><a id="13099" class="Bound">neq</a> <a id="13103" href="plfa.Soundness.html#13084" class="Bound">eq</a><a id="13105" class="Symbol">)</a>
<a id="13107" class="Symbol">...</a>  <a id="13112" class="Symbol">|</a> <a id="13114" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="13117" class="Symbol">_</a>    <a id="13122" class="Symbol">=</a>  <a id="13125" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="13781" href="/Soundness/#13781" class="Function">subst-reflect-var</a> <a id="13799" class="Symbol">:</a> <a id="13801" class="Symbol">∀</a> <a id="13803" class="Symbol">{</a><a id="13804" href="plfa.Soundness.html#13804" class="Bound">Γ</a> <a id="13806" href="plfa.Soundness.html#13806" class="Bound">Δ</a><a id="13807" class="Symbol">}</a> <a id="13809" class="Symbol">{</a><a id="13810" href="plfa.Soundness.html#13810" class="Bound">γ</a> <a id="13812" class="Symbol">:</a> <a id="13814" href="/Denotational/#7096" class="Function">Env</a> <a id="13818" href="plfa.Soundness.html#13806" class="Bound">Δ</a><a id="13819" class="Symbol">}</a> <a id="13821" class="Symbol">{</a><a id="13822" href="plfa.Soundness.html#13822" class="Bound">x</a> <a id="13824" class="Symbol">:</a> <a id="13826" href="plfa.Soundness.html#13804" class="Bound">Γ</a> <a id="13828" href="/Untyped/#3259" class="Datatype Operator">∋</a> <a id="13830" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="13831" class="Symbol">}</a> <a id="13833" class="Symbol">{</a><a id="13834" href="plfa.Soundness.html#13834" class="Bound">v</a><a id="13835" class="Symbol">}</a> <a id="13837" class="Symbol">{</a><a id="13838" href="plfa.Soundness.html#13838" class="Bound">σ</a> <a id="13840" class="Symbol">:</a> <a id="13842" href="/Substitution/#2431" class="Function">Subst</a> <a id="13848" href="plfa.Soundness.html#13804" class="Bound">Γ</a> <a id="13850" href="plfa.Soundness.html#13806" class="Bound">Δ</a><a id="13851" class="Symbol">}</a>
  <a id="13855" class="Symbol">→</a> <a id="13857" href="/Soundness/#13810" class="Bound">γ</a> <a id="13859" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="13861" href="plfa.Soundness.html#13838" class="Bound">σ</a> <a id="13863" href="plfa.Soundness.html#13822" class="Bound">x</a> <a id="13865" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="13867" href="plfa.Soundness.html#13834" class="Bound">v</a>
    <a id="13873" class="Comment">-----------------------------------------</a>
  <a id="13917" class="Symbol">→</a> <a id="13919" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="13922" href="/Soundness/#13922" class="Bound">δ</a> <a id="13924" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="13926" href="/Denotational/#7096" class="Function">Env</a> <a id="13930" href="plfa.Soundness.html#13804" class="Bound">Γ</a> <a id="13932" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="13934" href="plfa.Soundness.html#13810" class="Bound">γ</a> <a id="13936" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="13939" href="plfa.Soundness.html#13838" class="Bound">σ</a> <a id="13941" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="13943" href="plfa.Soundness.html#13922" class="Bound">δ</a>  <a id="13946" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="13949" href="plfa.Soundness.html#13922" class="Bound">δ</a> <a id="13951" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="13953" href="/Untyped/#4064" class="InductiveConstructor Operator">`</a> <a id="13955" href="plfa.Soundness.html#13822" class="Bound">x</a> <a id="13957" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="13959" href="plfa.Soundness.html#13834" class="Bound">v</a>
<a id="13961" href="/Soundness/#13781" class="Function">subst-reflect-var</a> <a id="13979" class="Symbol">{</a><a id="13980" href="plfa.Soundness.html#13980" class="Bound">Γ</a><a id="13981" class="Symbol">}{</a><a id="13983" href="plfa.Soundness.html#13983" class="Bound">Δ</a><a id="13984" class="Symbol">}{</a><a id="13986" href="plfa.Soundness.html#13986" class="Bound">γ</a><a id="13987" class="Symbol">}{</a><a id="13989" href="plfa.Soundness.html#13989" class="Bound">x</a><a id="13990" class="Symbol">}{</a><a id="13992" href="plfa.Soundness.html#13992" class="Bound">v</a><a id="13993" class="Symbol">}{</a><a id="13995" href="plfa.Soundness.html#13995" class="Bound">σ</a><a id="13996" class="Symbol">}</a> <a id="13998" href="plfa.Soundness.html#13998" class="Bound">xv</a>
  <a id="14003" class="Keyword">rewrite</a> <a id="14011" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14015" class="Symbol">(</a><a id="14016" href="/Soundness/#12744" class="Function">same-const-env</a> <a id="14031" class="Symbol">{</a><a id="14032" href="plfa.Soundness.html#13980" class="Bound">Γ</a><a id="14033" class="Symbol">}{</a><a id="14035" href="plfa.Soundness.html#13989" class="Bound">x</a><a id="14036" class="Symbol">}{</a><a id="14038" href="plfa.Soundness.html#13992" class="Bound">v</a><a id="14039" class="Symbol">})</a> <a id="14042" class="Symbol">=</a>
    <a id="14048" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14050" href="/Soundness/#12540" class="Function">const-env</a> <a id="14060" href="plfa.Soundness.html#13989" class="Bound">x</a> <a id="14062" href="plfa.Soundness.html#13992" class="Bound">v</a> <a id="14064" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14066" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14068" href="plfa.Soundness.html#14101" class="Function">const-env-ok</a> <a id="14081" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14083" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="14087" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14089" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="14093" class="Keyword">where</a>
  <a id="14101" href="/Soundness/#14101" class="Function">const-env-ok</a> <a id="14114" class="Symbol">:</a> <a id="14116" href="plfa.Soundness.html#13986" class="Bound">γ</a> <a id="14118" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="14121" href="plfa.Soundness.html#13995" class="Bound">σ</a> <a id="14123" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="14125" href="plfa.Soundness.html#12540" class="Function">const-env</a> <a id="14135" href="plfa.Soundness.html#13989" class="Bound">x</a> <a id="14137" href="plfa.Soundness.html#13992" class="Bound">v</a>
  <a id="14141" href="/Soundness/#14101" class="Function">const-env-ok</a> <a id="14154" href="plfa.Soundness.html#14154" class="Bound">y</a> <a id="14156" class="Keyword">with</a> <a id="14161" href="plfa.Soundness.html#13989" class="Bound">x</a> <a id="14163" href="plfa.Soundness.html#12124" class="Function Operator">var≟</a> <a id="14168" href="plfa.Soundness.html#14154" class="Bound">y</a>
  <a id="14172" class="Symbol">...</a> <a id="14176" class="Symbol">|</a> <a id="14178" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="14182" href="/Soundness/#14182" class="Bound">x≡y</a> <a id="14186" class="Keyword">rewrite</a> <a id="14194" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14198" href="plfa.Soundness.html#14182" class="Bound">x≡y</a> <a id="14202" class="Symbol">|</a> <a id="14204" href="plfa.Soundness.html#12744" class="Function">same-const-env</a> <a id="14219" class="Symbol">{</a><a id="14220" href="plfa.Soundness.html#13980" class="Bound">Γ</a><a id="14221" class="Symbol">}{</a><a id="14223" href="plfa.Soundness.html#13989" class="Bound">x</a><a id="14224" class="Symbol">}{</a><a id="14226" href="plfa.Soundness.html#13992" class="Bound">v</a><a id="14227" class="Symbol">}</a> <a id="14229" class="Symbol">=</a> <a id="14231" href="plfa.Soundness.html#13998" class="Bound">xv</a>
  <a id="14236" class="Symbol">...</a> <a id="14240" class="Symbol">|</a> <a id="14242" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="14245" href="/Soundness/#14245" class="Bound">x≢y</a> <a id="14249" class="Keyword">rewrite</a> <a id="14257" href="plfa.Soundness.html#12922" class="Function">diff-nth-const-env</a> <a id="14276" class="Symbol">{</a><a id="14277" href="plfa.Soundness.html#13980" class="Bound">Γ</a><a id="14278" class="Symbol">}{</a><a id="14280" href="plfa.Soundness.html#13989" class="Bound">x</a><a id="14281" class="Symbol">}{</a><a id="14283" class="Bound">y</a><a id="14284" class="Symbol">}{</a><a id="14286" href="plfa.Soundness.html#13992" class="Bound">v</a><a id="14287" class="Symbol">}</a> <a id="14289" href="plfa.Soundness.html#14245" class="Bound">x≢y</a> <a id="14293" class="Symbol">=</a> <a id="14295" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a>
</pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14422" href="/Soundness/#14422" class="Function">subst-⊥</a> <a id="14430" class="Symbol">:</a> <a id="14432" class="Symbol">∀{</a><a id="14434" href="plfa.Soundness.html#14434" class="Bound">Γ</a> <a id="14436" href="plfa.Soundness.html#14436" class="Bound">Δ</a><a id="14437" class="Symbol">}{</a><a id="14439" href="plfa.Soundness.html#14439" class="Bound">γ</a> <a id="14441" class="Symbol">:</a> <a id="14443" href="/Denotational/#7096" class="Function">Env</a> <a id="14447" href="plfa.Soundness.html#14436" class="Bound">Δ</a><a id="14448" class="Symbol">}{</a><a id="14450" href="plfa.Soundness.html#14450" class="Bound">σ</a> <a id="14452" class="Symbol">:</a> <a id="14454" href="/Substitution/#2431" class="Function">Subst</a> <a id="14460" href="plfa.Soundness.html#14434" class="Bound">Γ</a> <a id="14462" href="plfa.Soundness.html#14436" class="Bound">Δ</a><a id="14463" class="Symbol">}</a>
    <a id="14469" class="Comment">-----------------</a>
  <a id="14489" class="Symbol">→</a> <a id="14491" href="/Soundness/#14439" class="Bound">γ</a> <a id="14493" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="14496" href="plfa.Soundness.html#14450" class="Bound">σ</a> <a id="14498" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="14500" href="/Denotational/#8261" class="Function">`⊥</a>
<a id="14503" href="/Soundness/#14422" class="Function">subst-⊥</a> <a id="14511" href="plfa.Soundness.html#14511" class="Bound">x</a> <a id="14513" class="Symbol">=</a> <a id="14515" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a>
</pre>
<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14676" href="/Soundness/#14676" class="Function">subst-⊔</a> <a id="14684" class="Symbol">:</a> <a id="14686" class="Symbol">∀{</a><a id="14688" href="plfa.Soundness.html#14688" class="Bound">Γ</a> <a id="14690" href="plfa.Soundness.html#14690" class="Bound">Δ</a><a id="14691" class="Symbol">}{</a><a id="14693" href="plfa.Soundness.html#14693" class="Bound">γ</a> <a id="14695" class="Symbol">:</a> <a id="14697" href="/Denotational/#7096" class="Function">Env</a> <a id="14701" href="plfa.Soundness.html#14690" class="Bound">Δ</a><a id="14702" class="Symbol">}{</a><a id="14704" href="plfa.Soundness.html#14704" class="Bound">γ₁</a> <a id="14707" href="plfa.Soundness.html#14707" class="Bound">γ₂</a> <a id="14710" class="Symbol">:</a> <a id="14712" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="14716" href="plfa.Soundness.html#14688" class="Bound">Γ</a><a id="14717" class="Symbol">}{</a><a id="14719" href="plfa.Soundness.html#14719" class="Bound">σ</a> <a id="14721" class="Symbol">:</a> <a id="14723" href="/Substitution/#2431" class="Function">Subst</a> <a id="14729" href="plfa.Soundness.html#14688" class="Bound">Γ</a> <a id="14731" href="plfa.Soundness.html#14690" class="Bound">Δ</a><a id="14732" class="Symbol">}</a>
           <a id="14745" class="Symbol">→</a> <a id="14747" href="/Soundness/#14693" class="Bound">γ</a> <a id="14749" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="14752" href="plfa.Soundness.html#14719" class="Bound">σ</a> <a id="14754" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="14756" href="plfa.Soundness.html#14704" class="Bound">γ₁</a>
           <a id="14770" class="Symbol">→</a> <a id="14772" href="/Soundness/#14693" class="Bound">γ</a> <a id="14774" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="14777" href="plfa.Soundness.html#14719" class="Bound">σ</a> <a id="14779" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="14781" href="plfa.Soundness.html#14707" class="Bound">γ₂</a>
             <a id="14797" class="Comment">-------------------------</a>
           <a id="14834" class="Symbol">→</a> <a id="14836" href="/Soundness/#14693" class="Bound">γ</a> <a id="14838" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="14841" href="plfa.Soundness.html#14719" class="Bound">σ</a> <a id="14843" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="14845" class="Symbol">(</a><a id="14846" href="plfa.Soundness.html#14704" class="Bound">γ₁</a> <a id="14849" href="/Denotational/#8290" class="Function Operator">`⊔</a> <a id="14852" href="plfa.Soundness.html#14707" class="Bound">γ₂</a><a id="14854" class="Symbol">)</a>
<a id="14856" href="/Soundness/#14676" class="Function">subst-⊔</a> <a id="14864" href="plfa.Soundness.html#14864" class="Bound">γ₁-ok</a> <a id="14870" href="plfa.Soundness.html#14870" class="Bound">γ₂-ok</a> <a id="14876" href="plfa.Soundness.html#14876" class="Bound">x</a> <a id="14878" class="Symbol">=</a> <a id="14880" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="14888" class="Symbol">(</a><a id="14889" href="plfa.Soundness.html#14864" class="Bound">γ₁-ok</a> <a id="14895" href="plfa.Soundness.html#14876" class="Bound">x</a><a id="14896" class="Symbol">)</a> <a id="14898" class="Symbol">(</a><a id="14899" href="plfa.Soundness.html#14870" class="Bound">γ₂-ok</a> <a id="14905" href="plfa.Soundness.html#14876" class="Bound">x</a><a id="14906" class="Symbol">)</a>
</pre>
<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="14958" href="/Soundness/#14958" class="Function">lambda-inj</a> <a id="14969" class="Symbol">:</a> <a id="14971" class="Symbol">∀</a> <a id="14973" class="Symbol">{</a><a id="14974" href="plfa.Soundness.html#14974" class="Bound">Γ</a><a id="14975" class="Symbol">}</a> <a id="14977" class="Symbol">{</a><a id="14978" href="plfa.Soundness.html#14978" class="Bound">M</a> <a id="14980" href="plfa.Soundness.html#14980" class="Bound">N</a> <a id="14982" class="Symbol">:</a> <a id="14984" href="plfa.Soundness.html#14974" class="Bound">Γ</a> <a id="14986" href="/Untyped/#2944" class="InductiveConstructor Operator">,</a> <a id="14988" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a> <a id="14990" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="14992" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a> <a id="14994" class="Symbol">}</a>
  <a id="14998" class="Symbol">→</a> <a id="15000" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a> <a id="15004" class="Symbol">{</a><a id="15005" class="Argument">A</a> <a id="15007" class="Symbol">=</a> <a id="15009" href="/Soundness/#14974" class="Bound">Γ</a> <a id="15011" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="15013" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="15014" class="Symbol">}</a> <a id="15016" class="Symbol">(</a><a id="15017" href="plfa.Untyped.html#4116" class="InductiveConstructor Operator">ƛ</a> <a id="15019" href="plfa.Soundness.html#14978" class="Bound">M</a><a id="15020" class="Symbol">)</a> <a id="15022" class="Symbol">(</a><a id="15023" href="plfa.Untyped.html#4116" class="InductiveConstructor Operator">ƛ</a> <a id="15025" href="plfa.Soundness.html#14980" class="Bound">N</a><a id="15026" class="Symbol">)</a>
    <a id="15032" class="Comment">---------------------------</a>
  <a id="15062" class="Symbol">→</a> <a id="15064" href="/Soundness/#14978" class="Bound">M</a> <a id="15066" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15068" href="plfa.Soundness.html#14980" class="Bound">N</a>
<a id="15070" href="/Soundness/#14958" class="Function">lambda-inj</a> <a id="15081" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="15086" class="Symbol">=</a> <a id="15088" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15494" href="/Soundness/#15494" class="Function">split</a> <a id="15500" class="Symbol">:</a> <a id="15502" class="Symbol">∀</a> <a id="15504" class="Symbol">{</a><a id="15505" href="plfa.Soundness.html#15505" class="Bound">Γ</a><a id="15506" class="Symbol">}</a> <a id="15508" class="Symbol">{</a><a id="15509" href="plfa.Soundness.html#15509" class="Bound">M</a> <a id="15511" class="Symbol">:</a> <a id="15513" href="plfa.Soundness.html#15505" class="Bound">Γ</a> <a id="15515" href="/Untyped/#2944" class="InductiveConstructor Operator">,</a> <a id="15517" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a> <a id="15519" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="15521" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="15522" class="Symbol">}</a> <a id="15524" class="Symbol">{</a><a id="15525" href="plfa.Soundness.html#15525" class="Bound">δ</a> <a id="15527" class="Symbol">:</a> <a id="15529" href="/Denotational/#7096" class="Function">Env</a> <a id="15533" class="Symbol">(</a><a id="15534" href="plfa.Soundness.html#15505" class="Bound">Γ</a> <a id="15536" href="plfa.Untyped.html#2944" class="InductiveConstructor Operator">,</a> <a id="15538" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="15539" class="Symbol">)}</a> <a id="15542" class="Symbol">{</a><a id="15543" href="plfa.Soundness.html#15543" class="Bound">v</a><a id="15544" class="Symbol">}</a>
  <a id="15548" class="Symbol">→</a> <a id="15550" href="/Soundness/#15525" class="Bound">δ</a> <a id="15552" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="15554" href="plfa.Soundness.html#15509" class="Bound">M</a> <a id="15556" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="15558" href="plfa.Soundness.html#15543" class="Bound">v</a>
    <a id="15564" class="Comment">--------------------------</a>
  <a id="15593" class="Symbol">→</a> <a id="15595" class="Symbol">(</a><a id="15596" href="/Denotational/#7490" class="Function">init</a> <a id="15601" href="/Soundness/#15525" class="Bound">δ</a> <a id="15603" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="15606" href="plfa.Denotational.html#7545" class="Function">last</a> <a id="15611" href="plfa.Soundness.html#15525" class="Bound">δ</a><a id="15612" class="Symbol">)</a> <a id="15614" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="15616" href="plfa.Soundness.html#15509" class="Bound">M</a> <a id="15618" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="15620" href="plfa.Soundness.html#15543" class="Bound">v</a>
<a id="15622" href="/Soundness/#15494" class="Function">split</a> <a id="15628" class="Symbol">{</a><a id="15629" class="Argument">δ</a> <a id="15631" class="Symbol">=</a> <a id="15633" href="plfa.Soundness.html#15633" class="Bound">δ</a><a id="15634" class="Symbol">}</a> <a id="15636" href="plfa.Soundness.html#15636" class="Bound">δMv</a> <a id="15640" class="Keyword">rewrite</a> <a id="15648" href="/Denotational/#7594" class="Function">init-last</a> <a id="15658" href="plfa.Soundness.html#15633" class="Bound">δ</a> <a id="15660" class="Symbol">=</a> <a id="15662" href="plfa.Soundness.html#15636" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15667" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="15681" class="Symbol">:</a> <a id="15683" class="Symbol">∀</a> <a id="15685" class="Symbol">{</a><a id="15686" href="plfa.Soundness.html#15686" class="Bound">Γ</a> <a id="15688" href="plfa.Soundness.html#15688" class="Bound">Δ</a><a id="15689" class="Symbol">}</a> <a id="15691" class="Symbol">{</a><a id="15692" href="plfa.Soundness.html#15692" class="Bound">δ</a> <a id="15694" class="Symbol">:</a> <a id="15696" href="/Denotational/#7096" class="Function">Env</a> <a id="15700" href="plfa.Soundness.html#15688" class="Bound">Δ</a><a id="15701" class="Symbol">}</a> <a id="15703" class="Symbol">{</a><a id="15704" href="plfa.Soundness.html#15704" class="Bound">M</a> <a id="15706" class="Symbol">:</a> <a id="15708" href="plfa.Soundness.html#15686" class="Bound">Γ</a> <a id="15710" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="15712" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="15713" class="Symbol">}</a> <a id="15715" class="Symbol">{</a><a id="15716" href="plfa.Soundness.html#15716" class="Bound">v</a><a id="15717" class="Symbol">}</a> <a id="15719" class="Symbol">{</a><a id="15720" href="plfa.Soundness.html#15720" class="Bound">L</a> <a id="15722" class="Symbol">:</a> <a id="15724" href="plfa.Soundness.html#15688" class="Bound">Δ</a> <a id="15726" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="15728" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="15729" class="Symbol">}</a> <a id="15731" class="Symbol">{</a><a id="15732" href="plfa.Soundness.html#15732" class="Bound">σ</a> <a id="15734" class="Symbol">:</a> <a id="15736" href="/Substitution/#2431" class="Function">Subst</a> <a id="15742" href="plfa.Soundness.html#15686" class="Bound">Γ</a> <a id="15744" href="plfa.Soundness.html#15688" class="Bound">Δ</a><a id="15745" class="Symbol">}</a>
  <a id="15749" class="Symbol">→</a> <a id="15751" href="/Soundness/#15692" class="Bound">δ</a> <a id="15753" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="15755" href="plfa.Soundness.html#15720" class="Bound">L</a> <a id="15757" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="15759" href="plfa.Soundness.html#15716" class="Bound">v</a>
  <a id="15763" class="Symbol">→</a> <a id="15765" href="/Untyped/#6697" class="Function">subst</a> <a id="15771" href="/Soundness/#15732" class="Bound">σ</a> <a id="15773" href="plfa.Soundness.html#15704" class="Bound">M</a> <a id="15775" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15777" href="plfa.Soundness.html#15720" class="Bound">L</a>
    <a id="15783" class="Comment">---------------------------------------</a>
  <a id="15825" class="Symbol">→</a> <a id="15827" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="15830" href="/Soundness/#15830" class="Bound">γ</a> <a id="15832" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="15834" href="/Denotational/#7096" class="Function">Env</a> <a id="15838" href="plfa.Soundness.html#15686" class="Bound">Γ</a> <a id="15840" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="15842" href="plfa.Soundness.html#15692" class="Bound">δ</a> <a id="15844" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="15847" href="plfa.Soundness.html#15732" class="Bound">σ</a> <a id="15849" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="15851" href="plfa.Soundness.html#15830" class="Bound">γ</a>  <a id="15854" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="15857" href="plfa.Soundness.html#15830" class="Bound">γ</a> <a id="15859" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="15861" href="plfa.Soundness.html#15704" class="Bound">M</a> <a id="15863" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="15865" href="plfa.Soundness.html#15716" class="Bound">v</a>

<a id="15868" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="15882" class="Symbol">{</a><a id="15883" class="Argument">M</a> <a id="15885" class="Symbol">=</a> <a id="15887" href="plfa.Soundness.html#15887" class="Bound">M</a><a id="15888" class="Symbol">}{</a><a id="15890" class="Argument">σ</a> <a id="15892" class="Symbol">=</a> <a id="15894" href="plfa.Soundness.html#15894" class="Bound">σ</a><a id="15895" class="Symbol">}</a> <a id="15897" class="Symbol">(</a><a id="15898" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="15902" class="Symbol">{</a><a id="15903" class="Argument">x</a> <a id="15905" class="Symbol">=</a> <a id="15907" href="plfa.Soundness.html#15907" class="Bound">y</a><a id="15908" class="Symbol">})</a> <a id="15911" href="plfa.Soundness.html#15911" class="Bound">eqL</a> <a id="15915" class="Keyword">with</a> <a id="15920" href="plfa.Soundness.html#15887" class="Bound">M</a>
<a id="15922" class="Symbol">...</a> <a id="15926" class="Symbol">|</a> <a id="15928" href="/Untyped/#4064" class="InductiveConstructor Operator">`</a> <a id="15930" href="/Soundness/#15930" class="Bound">x</a>  <a id="15933" class="Keyword">with</a> <a id="15938" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="15942" class="Symbol">{</a><a id="15943" class="Argument">x</a> <a id="15945" class="Symbol">=</a> <a id="15947" class="Bound">y</a><a id="15948" class="Symbol">}</a>
<a id="15950" class="Symbol">...</a>           <a id="15964" class="Symbol">|</a> <a id="15966" href="/Soundness/#15966" class="Bound">yv</a>  <a id="15970" class="Keyword">rewrite</a> <a id="15978" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="15982" class="Bound">eqL</a> <a id="15986" class="Symbol">=</a> <a id="15988" href="plfa.Soundness.html#13781" class="Function">subst-reflect-var</a> <a id="16006" class="Symbol">{</a><a id="16007" class="Argument">σ</a> <a id="16009" class="Symbol">=</a> <a id="16011" class="Bound">σ</a><a id="16012" class="Symbol">}</a> <a id="16014" href="plfa.Soundness.html#15966" class="Bound">yv</a>
<a id="16017" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16031" class="Symbol">{</a><a id="16032" class="Argument">M</a> <a id="16034" class="Symbol">=</a> <a id="16036" href="plfa.Soundness.html#16036" class="Bound">M</a><a id="16037" class="Symbol">}</a> <a id="16039" class="Symbol">(</a><a id="16040" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="16044" class="Symbol">{</a><a id="16045" class="Argument">x</a> <a id="16047" class="Symbol">=</a> <a id="16049" href="plfa.Soundness.html#16049" class="Bound">y</a><a id="16050" class="Symbol">})</a> <a id="16053" class="Symbol">()</a> <a id="16056" class="Symbol">|</a> <a id="16058" href="plfa.Soundness.html#16058" class="Bound">M₁</a> <a id="16061" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="16063" href="plfa.Soundness.html#16063" class="Bound">M₂</a>
<a id="16066" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16080" class="Symbol">{</a><a id="16081" class="Argument">M</a> <a id="16083" class="Symbol">=</a> <a id="16085" href="plfa.Soundness.html#16085" class="Bound">M</a><a id="16086" class="Symbol">}</a> <a id="16088" class="Symbol">(</a><a id="16089" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="16093" class="Symbol">{</a><a id="16094" class="Argument">x</a> <a id="16096" class="Symbol">=</a> <a id="16098" href="plfa.Soundness.html#16098" class="Bound">y</a><a id="16099" class="Symbol">})</a> <a id="16102" class="Symbol">()</a> <a id="16105" class="Symbol">|</a> <a id="16107" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="16109" href="plfa.Soundness.html#16109" class="Bound">M′</a>

<a id="16113" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16127" class="Symbol">{</a><a id="16128" class="Argument">M</a> <a id="16130" class="Symbol">=</a> <a id="16132" href="plfa.Soundness.html#16132" class="Bound">M</a><a id="16133" class="Symbol">}{</a><a id="16135" class="Argument">σ</a> <a id="16137" class="Symbol">=</a> <a id="16139" href="plfa.Soundness.html#16139" class="Bound">σ</a><a id="16140" class="Symbol">}</a> <a id="16142" class="Symbol">(</a><a id="16143" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="16150" href="plfa.Soundness.html#16150" class="Bound">d₁</a> <a id="16153" href="plfa.Soundness.html#16153" class="Bound">d₂</a><a id="16155" class="Symbol">)</a> <a id="16157" href="plfa.Soundness.html#16157" class="Bound">eqL</a>
         <a id="16170" class="Keyword">with</a> <a id="16175" href="/Soundness/#16132" class="Bound">M</a>
<a id="16177" class="Symbol">...</a>    <a id="16184" class="Symbol">|</a> <a id="16186" href="/Untyped/#4064" class="InductiveConstructor Operator">`</a> <a id="16188" href="/Soundness/#16188" class="Bound">x</a> <a id="16190" class="Keyword">with</a> <a id="16195" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="16202" class="Bound">d₁</a> <a id="16205" class="Bound">d₂</a>
<a id="16208" class="Symbol">...</a>    <a id="16215" class="Symbol">|</a> <a id="16217" href="/Soundness/#16217" class="Bound">d′</a> <a id="16220" class="Keyword">rewrite</a> <a id="16228" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16232" class="Bound">eqL</a> <a id="16236" class="Symbol">=</a> <a id="16238" href="plfa.Soundness.html#13781" class="Function">subst-reflect-var</a> <a id="16256" class="Symbol">{</a><a id="16257" class="Argument">σ</a> <a id="16259" class="Symbol">=</a> <a id="16261" class="Bound">σ</a><a id="16262" class="Symbol">}</a> <a id="16264" href="plfa.Soundness.html#16217" class="Bound">d′</a>
<a id="16267" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16281" class="Symbol">(</a><a id="16282" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="16289" href="plfa.Soundness.html#16289" class="Bound">d₁</a> <a id="16292" href="plfa.Soundness.html#16292" class="Bound">d₂</a><a id="16294" class="Symbol">)</a> <a id="16296" class="Symbol">()</a> <a id="16299" class="Symbol">|</a> <a id="16301" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="16303" href="plfa.Soundness.html#16303" class="Bound">M′</a>
<a id="16306" href="/Soundness/#15667" class="Function">subst-reflect</a><a id="16319" class="Symbol">{</a><a id="16320" href="plfa.Soundness.html#16320" class="Bound">Γ</a><a id="16321" class="Symbol">}{</a><a id="16323" href="plfa.Soundness.html#16323" class="Bound">Δ</a><a id="16324" class="Symbol">}{</a><a id="16326" href="plfa.Soundness.html#16326" class="Bound">γ</a><a id="16327" class="Symbol">}{</a><a id="16329" class="Argument">σ</a> <a id="16331" class="Symbol">=</a> <a id="16333" href="plfa.Soundness.html#16333" class="Bound">σ</a><a id="16334" class="Symbol">}</a> <a id="16336" class="Symbol">(</a><a id="16337" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="16344" href="plfa.Soundness.html#16344" class="Bound">d₁</a> <a id="16347" href="plfa.Soundness.html#16347" class="Bound">d₂</a><a id="16349" class="Symbol">)</a>
   <a id="16354" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16359" class="Symbol">|</a> <a id="16361" href="/Soundness/#16361" class="Bound">M₁</a> <a id="16364" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="16366" href="plfa.Soundness.html#16366" class="Bound">M₂</a>
     <a id="16374" class="Keyword">with</a> <a id="16379" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16393" class="Symbol">{</a><a id="16394" class="Argument">M</a> <a id="16396" class="Symbol">=</a> <a id="16398" href="plfa.Soundness.html#16361" class="Bound">M₁</a><a id="16400" class="Symbol">}</a> <a id="16402" href="plfa.Soundness.html#16344" class="Bound">d₁</a> <a id="16405" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16410" class="Symbol">|</a> <a id="16412" href="plfa.Soundness.html#15667" class="Function">subst-reflect</a> <a id="16426" class="Symbol">{</a><a id="16427" class="Argument">M</a> <a id="16429" class="Symbol">=</a> <a id="16431" href="plfa.Soundness.html#16366" class="Bound">M₂</a><a id="16433" class="Symbol">}</a> <a id="16435" href="plfa.Soundness.html#16347" class="Bound">d₂</a> <a id="16438" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="16443" class="Symbol">...</a>     <a id="16451" class="Symbol">|</a> <a id="16453" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16455" href="/Soundness/#16455" class="Bound">δ₁</a> <a id="16458" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16460" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16462" href="plfa.Soundness.html#16462" class="Bound">subst-δ₁</a> <a id="16471" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16473" href="plfa.Soundness.html#16473" class="Bound">m1</a> <a id="16476" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16478" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16480" class="Symbol">|</a> <a id="16482" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16484" href="plfa.Soundness.html#16484" class="Bound">δ₂</a> <a id="16487" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16489" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16491" href="plfa.Soundness.html#16491" class="Bound">subst-δ₂</a> <a id="16500" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16502" href="plfa.Soundness.html#16502" class="Bound">m2</a> <a id="16505" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16507" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16509" class="Symbol">=</a>
     <a id="16516" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16518" href="/Soundness/#16455" class="Bound">δ₁</a> <a id="16521" href="/Denotational/#8290" class="Function Operator">`⊔</a> <a id="16524" href="plfa.Soundness.html#16484" class="Bound">δ₂</a> <a id="16527" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16529" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16531" href="plfa.Soundness.html#14676" class="Function">subst-⊔</a> <a id="16539" class="Symbol">{</a><a id="16540" class="Argument">γ₁</a> <a id="16543" class="Symbol">=</a> <a id="16545" href="plfa.Soundness.html#16455" class="Bound">δ₁</a><a id="16547" class="Symbol">}{</a><a id="16549" class="Argument">γ₂</a> <a id="16552" class="Symbol">=</a> <a id="16554" href="plfa.Soundness.html#16484" class="Bound">δ₂</a><a id="16556" class="Symbol">}{</a><a id="16558" class="Argument">σ</a> <a id="16560" class="Symbol">=</a> <a id="16562" class="Bound">σ</a><a id="16563" class="Symbol">}</a> <a id="16565" href="plfa.Soundness.html#16462" class="Bound">subst-δ₁</a> <a id="16574" href="plfa.Soundness.html#16491" class="Bound">subst-δ₂</a> <a id="16583" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="16605" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="16612" class="Symbol">(</a><a id="16613" href="plfa.Denotational.html#25004" class="Function">Env⊑</a> <a id="16618" href="/Soundness/#16473" class="Bound">m1</a> <a id="16621" class="Symbol">(</a><a id="16622" href="plfa.Denotational.html#8612" class="Function">EnvConjR1⊑</a> <a id="16633" href="plfa.Soundness.html#16455" class="Bound">δ₁</a> <a id="16636" href="plfa.Soundness.html#16484" class="Bound">δ₂</a><a id="16638" class="Symbol">))</a>
                           <a id="16668" class="Symbol">(</a><a id="16669" href="/Denotational/#25004" class="Function">Env⊑</a> <a id="16674" href="/Soundness/#16502" class="Bound">m2</a> <a id="16677" class="Symbol">(</a><a id="16678" href="plfa.Denotational.html#8709" class="Function">EnvConjR2⊑</a> <a id="16689" href="plfa.Soundness.html#16455" class="Bound">δ₁</a> <a id="16692" href="plfa.Soundness.html#16484" class="Bound">δ₂</a><a id="16694" class="Symbol">))</a> <a id="16697" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16699" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="16702" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16716" class="Symbol">{</a><a id="16717" class="Argument">M</a> <a id="16719" class="Symbol">=</a> <a id="16721" href="plfa.Soundness.html#16721" class="Bound">M</a><a id="16722" class="Symbol">}{</a><a id="16724" class="Argument">σ</a> <a id="16726" class="Symbol">=</a> <a id="16728" href="plfa.Soundness.html#16728" class="Bound">σ</a><a id="16729" class="Symbol">}</a> <a id="16731" class="Symbol">(</a><a id="16732" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="16740" href="plfa.Soundness.html#16740" class="Bound">d</a><a id="16741" class="Symbol">)</a> <a id="16743" href="plfa.Soundness.html#16743" class="Bound">eqL</a> <a id="16747" class="Keyword">with</a> <a id="16752" href="plfa.Soundness.html#16721" class="Bound">M</a>
<a id="16754" class="Symbol">...</a>    <a id="16761" class="Symbol">|</a> <a id="16763" href="/Untyped/#4064" class="InductiveConstructor Operator">`</a> <a id="16765" href="/Soundness/#16765" class="Bound">x</a> <a id="16767" class="Keyword">with</a> <a id="16772" class="Symbol">(</a><a id="16773" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="16781" class="Bound">d</a><a id="16782" class="Symbol">)</a>
<a id="16784" class="Symbol">...</a>             <a id="16800" class="Symbol">|</a> <a id="16802" href="/Soundness/#16802" class="Bound">d′</a> <a id="16805" class="Keyword">rewrite</a> <a id="16813" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16817" class="Bound">eqL</a> <a id="16821" class="Symbol">=</a> <a id="16823" href="plfa.Soundness.html#13781" class="Function">subst-reflect-var</a> <a id="16841" class="Symbol">{</a><a id="16842" class="Argument">σ</a> <a id="16844" class="Symbol">=</a> <a id="16846" class="Bound">σ</a><a id="16847" class="Symbol">}</a> <a id="16849" href="plfa.Soundness.html#16802" class="Bound">d′</a>
<a id="16852" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16866" class="Symbol">{</a><a id="16867" class="Argument">σ</a> <a id="16869" class="Symbol">=</a> <a id="16871" href="plfa.Soundness.html#16871" class="Bound">σ</a><a id="16872" class="Symbol">}</a> <a id="16874" class="Symbol">(</a><a id="16875" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="16883" href="plfa.Soundness.html#16883" class="Bound">d</a><a id="16884" class="Symbol">)</a> <a id="16886" href="plfa.Soundness.html#16886" class="Bound">eq</a> <a id="16889" class="Symbol">|</a> <a id="16891" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="16893" href="plfa.Soundness.html#16893" class="Bound">M′</a>
      <a id="16902" class="Keyword">with</a> <a id="16907" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="16921" class="Symbol">{</a><a id="16922" class="Argument">σ</a> <a id="16924" class="Symbol">=</a> <a id="16926" href="/Untyped/#6405" class="Function">exts</a> <a id="16931" href="plfa.Soundness.html#16871" class="Bound">σ</a><a id="16932" class="Symbol">}</a> <a id="16934" href="plfa.Soundness.html#16883" class="Bound">d</a> <a id="16936" class="Symbol">(</a><a id="16937" href="plfa.Soundness.html#14958" class="Function">lambda-inj</a> <a id="16948" href="plfa.Soundness.html#16886" class="Bound">eq</a><a id="16950" class="Symbol">)</a>
<a id="16952" class="Symbol">...</a> <a id="16956" class="Symbol">|</a> <a id="16958" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16960" href="/Soundness/#16960" class="Bound">δ′</a> <a id="16963" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16965" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16967" href="plfa.Soundness.html#16967" class="Bound">exts-σ-δ′</a> <a id="16977" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16979" href="plfa.Soundness.html#16979" class="Bound">m′</a> <a id="16982" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16984" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16986" class="Symbol">=</a>
    <a id="16992" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16994" href="/Denotational/#7490" class="Function">init</a> <a id="16999" href="/Soundness/#16960" class="Bound">δ′</a> <a id="17002" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17004" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17006" class="Symbol">((λ</a> <a id="17010" href="plfa.Soundness.html#17010" class="Bound">x</a> <a id="17012" class="Symbol">→</a> <a id="17014" href="plfa.Soundness.html#11221" class="Function">rename-inc-reflect</a> <a id="17033" class="Symbol">(</a><a id="17034" href="plfa.Soundness.html#16967" class="Bound">exts-σ-δ′</a> <a id="17044" class="Symbol">(</a><a id="17045" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="17047" href="plfa.Soundness.html#17010" class="Bound">x</a><a id="17048" class="Symbol">))))</a> <a id="17053" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
             <a id="17068" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="17076" class="Symbol">(</a><a id="17077" href="plfa.Denotational.html#25432" class="Function">up-env</a> <a id="17084" class="Symbol">(</a><a id="17085" href="/Soundness/#15494" class="Function">split</a> <a id="17091" href="plfa.Soundness.html#16979" class="Bound">m′</a><a id="17093" class="Symbol">)</a> <a id="17095" class="Symbol">(</a><a id="17096" href="/Compositional/#9665" class="Function">var-inv</a> <a id="17104" class="Symbol">(</a><a id="17105" href="plfa.Soundness.html#16967" class="Bound">exts-σ-δ′</a> <a id="17115" href="/Untyped/#3295" class="InductiveConstructor">Z</a><a id="17116" class="Symbol">)))</a> <a id="17120" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17122" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17124" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17138" class="Symbol">(</a><a id="17139" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="17147" href="plfa.Soundness.html#17147" class="Bound">d</a><a id="17148" class="Symbol">)</a> <a id="17150" class="Symbol">()</a> <a id="17153" class="Symbol">|</a> <a id="17155" href="plfa.Soundness.html#17155" class="Bound">M₁</a> <a id="17158" href="/Untyped/#4176" class="InductiveConstructor Operator">·</a> <a id="17160" href="plfa.Soundness.html#17160" class="Bound">M₂</a>

<a id="17164" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17178" class="Symbol">{</a><a id="17179" class="Argument">σ</a> <a id="17181" class="Symbol">=</a> <a id="17183" href="plfa.Soundness.html#17183" class="Bound">σ</a><a id="17184" class="Symbol">}</a> <a id="17186" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="17194" href="plfa.Soundness.html#17194" class="Bound">eq</a> <a id="17197" class="Symbol">=</a>
    <a id="17203" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17205" href="/Denotational/#8261" class="Function">`⊥</a> <a id="17208" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17210" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17212" href="/Soundness/#14422" class="Function">subst-⊥</a> <a id="17220" class="Symbol">{</a><a id="17221" class="Argument">σ</a> <a id="17223" class="Symbol">=</a> <a id="17225" href="plfa.Soundness.html#17183" class="Bound">σ</a><a id="17226" class="Symbol">}</a> <a id="17228" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17230" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a> <a id="17238" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17240" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="17243" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17257" class="Symbol">{</a><a id="17258" class="Argument">σ</a> <a id="17260" class="Symbol">=</a> <a id="17262" href="plfa.Soundness.html#17262" class="Bound">σ</a><a id="17263" class="Symbol">}</a> <a id="17265" class="Symbol">(</a><a id="17266" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="17274" href="plfa.Soundness.html#17274" class="Bound">d₁</a> <a id="17277" href="plfa.Soundness.html#17277" class="Bound">d₂</a><a id="17279" class="Symbol">)</a> <a id="17281" href="plfa.Soundness.html#17281" class="Bound">eq</a>
  <a id="17286" class="Keyword">with</a> <a id="17291" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17305" class="Symbol">{</a><a id="17306" class="Argument">σ</a> <a id="17308" class="Symbol">=</a> <a id="17310" href="plfa.Soundness.html#17262" class="Bound">σ</a><a id="17311" class="Symbol">}</a> <a id="17313" href="plfa.Soundness.html#17274" class="Bound">d₁</a> <a id="17316" href="plfa.Soundness.html#17281" class="Bound">eq</a> <a id="17319" class="Symbol">|</a> <a id="17321" href="plfa.Soundness.html#15667" class="Function">subst-reflect</a> <a id="17335" class="Symbol">{</a><a id="17336" class="Argument">σ</a> <a id="17338" class="Symbol">=</a> <a id="17340" href="plfa.Soundness.html#17262" class="Bound">σ</a><a id="17341" class="Symbol">}</a> <a id="17343" href="plfa.Soundness.html#17277" class="Bound">d₂</a> <a id="17346" href="plfa.Soundness.html#17281" class="Bound">eq</a>
<a id="17349" class="Symbol">...</a> <a id="17353" class="Symbol">|</a> <a id="17355" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17357" href="/Soundness/#17357" class="Bound">δ₁</a> <a id="17360" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17362" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17364" href="plfa.Soundness.html#17364" class="Bound">subst-δ₁</a> <a id="17373" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17375" href="plfa.Soundness.html#17375" class="Bound">m1</a> <a id="17378" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17380" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17382" class="Symbol">|</a> <a id="17384" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17386" href="plfa.Soundness.html#17386" class="Bound">δ₂</a> <a id="17389" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17391" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17393" href="plfa.Soundness.html#17393" class="Bound">subst-δ₂</a> <a id="17402" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17404" href="plfa.Soundness.html#17404" class="Bound">m2</a> <a id="17407" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17409" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17411" class="Symbol">=</a>
     <a id="17418" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17420" href="/Soundness/#17357" class="Bound">δ₁</a> <a id="17423" href="/Denotational/#8290" class="Function Operator">`⊔</a> <a id="17426" href="plfa.Soundness.html#17386" class="Bound">δ₂</a> <a id="17429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17431" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17433" href="plfa.Soundness.html#14676" class="Function">subst-⊔</a> <a id="17441" class="Symbol">{</a><a id="17442" class="Argument">γ₁</a> <a id="17445" class="Symbol">=</a> <a id="17447" href="plfa.Soundness.html#17357" class="Bound">δ₁</a><a id="17449" class="Symbol">}{</a><a id="17451" class="Argument">γ₂</a> <a id="17454" class="Symbol">=</a> <a id="17456" href="plfa.Soundness.html#17386" class="Bound">δ₂</a><a id="17458" class="Symbol">}{</a><a id="17460" class="Argument">σ</a> <a id="17462" class="Symbol">=</a> <a id="17464" class="Bound">σ</a><a id="17465" class="Symbol">}</a> <a id="17467" href="plfa.Soundness.html#17364" class="Bound">subst-δ₁</a> <a id="17476" href="plfa.Soundness.html#17393" class="Bound">subst-δ₂</a> <a id="17485" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="17507" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="17515" class="Symbol">(</a><a id="17516" href="plfa.Denotational.html#25004" class="Function">Env⊑</a> <a id="17521" href="/Soundness/#17375" class="Bound">m1</a> <a id="17524" class="Symbol">(</a><a id="17525" href="plfa.Denotational.html#8612" class="Function">EnvConjR1⊑</a> <a id="17536" href="plfa.Soundness.html#17357" class="Bound">δ₁</a> <a id="17539" href="plfa.Soundness.html#17386" class="Bound">δ₂</a><a id="17541" class="Symbol">))</a>
                            <a id="17572" class="Symbol">(</a><a id="17573" href="/Denotational/#25004" class="Function">Env⊑</a> <a id="17578" href="/Soundness/#17404" class="Bound">m2</a> <a id="17581" class="Symbol">(</a><a id="17582" href="plfa.Denotational.html#8709" class="Function">EnvConjR2⊑</a> <a id="17593" href="plfa.Soundness.html#17357" class="Bound">δ₁</a> <a id="17596" href="plfa.Soundness.html#17386" class="Bound">δ₂</a><a id="17598" class="Symbol">))</a> <a id="17601" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17603" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17605" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17619" class="Symbol">(</a><a id="17620" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="17624" href="plfa.Soundness.html#17624" class="Bound">d</a> <a id="17626" href="plfa.Soundness.html#17626" class="Bound">lt</a><a id="17628" class="Symbol">)</a> <a id="17630" href="plfa.Soundness.html#17630" class="Bound">eq</a>
    <a id="17637" class="Keyword">with</a> <a id="17642" href="/Soundness/#15667" class="Function">subst-reflect</a> <a id="17656" href="plfa.Soundness.html#17624" class="Bound">d</a> <a id="17658" href="plfa.Soundness.html#17630" class="Bound">eq</a>
<a id="17661" class="Symbol">...</a> <a id="17665" class="Symbol">|</a> <a id="17667" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17669" href="/Soundness/#17669" class="Bound">δ</a> <a id="17671" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17673" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17675" href="plfa.Soundness.html#17675" class="Bound">subst-δ</a> <a id="17683" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17685" href="plfa.Soundness.html#17685" class="Bound">m</a> <a id="17687" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17689" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17691" class="Symbol">=</a> <a id="17693" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17695" href="plfa.Soundness.html#17669" class="Bound">δ</a> <a id="17697" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17699" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17701" href="plfa.Soundness.html#17675" class="Bound">subst-δ</a> <a id="17709" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17711" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="17715" href="plfa.Soundness.html#17685" class="Bound">m</a> <a id="17717" class="Bound">lt</a> <a id="17720" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17722" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L′</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M′</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v′</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v′ ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code class="highlighter-rouge">δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ′<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ′`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.</p>

<p>We first prove a lemma about <code class="highlighter-rouge">subst-zero</code>, that if
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code>, then
<code class="highlighter-rouge">γ ⊑ (δ , w) × δ ⊢ M ↓ w</code> for some <code class="highlighter-rouge">w</code>.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20146" href="/Soundness/#20146" class="Function">subst-zero-reflect</a> <a id="20165" class="Symbol">:</a> <a id="20167" class="Symbol">∀</a> <a id="20169" class="Symbol">{</a><a id="20170" href="plfa.Soundness.html#20170" class="Bound">Δ</a><a id="20171" class="Symbol">}</a> <a id="20173" class="Symbol">{</a><a id="20174" href="plfa.Soundness.html#20174" class="Bound">δ</a> <a id="20176" class="Symbol">:</a> <a id="20178" href="/Denotational/#7096" class="Function">Env</a> <a id="20182" href="plfa.Soundness.html#20170" class="Bound">Δ</a><a id="20183" class="Symbol">}</a> <a id="20185" class="Symbol">{</a><a id="20186" href="plfa.Soundness.html#20186" class="Bound">γ</a> <a id="20188" class="Symbol">:</a> <a id="20190" href="plfa.Denotational.html#7096" class="Function">Env</a> <a id="20194" class="Symbol">(</a><a id="20195" href="plfa.Soundness.html#20170" class="Bound">Δ</a> <a id="20197" href="/Untyped/#2944" class="InductiveConstructor Operator">,</a> <a id="20199" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="20200" class="Symbol">)}</a> <a id="20203" class="Symbol">{</a><a id="20204" href="plfa.Soundness.html#20204" class="Bound">M</a> <a id="20206" class="Symbol">:</a> <a id="20208" href="plfa.Soundness.html#20170" class="Bound">Δ</a> <a id="20210" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="20212" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="20213" class="Symbol">}</a>
  <a id="20217" class="Symbol">→</a> <a id="20219" href="/Soundness/#20174" class="Bound">δ</a> <a id="20221" href="plfa.Soundness.html#3231" class="Function Operator">`⊢</a> <a id="20224" href="/Untyped/#7109" class="Function">subst-zero</a> <a id="20235" href="plfa.Soundness.html#20204" class="Bound">M</a> <a id="20237" href="plfa.Soundness.html#3231" class="Function Operator">↓</a> <a id="20239" href="plfa.Soundness.html#20186" class="Bound">γ</a>
    <a id="20245" class="Comment">----------------------------------------</a>
  <a id="20288" class="Symbol">→</a> <a id="20290" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="20293" href="/Soundness/#20293" class="Bound">w</a> <a id="20295" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="20297" href="/Denotational/#3958" class="Datatype">Value</a> <a id="20303" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="20305" href="plfa.Soundness.html#20186" class="Bound">γ</a> <a id="20307" href="plfa.Denotational.html#8058" class="Function Operator">`⊑</a> <a id="20310" class="Symbol">(</a><a id="20311" href="plfa.Soundness.html#20174" class="Bound">δ</a> <a id="20313" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="20316" href="plfa.Soundness.html#20293" class="Bound">w</a><a id="20317" class="Symbol">)</a> <a id="20319" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="20321" href="plfa.Soundness.html#20174" class="Bound">δ</a> <a id="20323" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="20325" href="plfa.Soundness.html#20204" class="Bound">M</a> <a id="20327" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="20329" href="plfa.Soundness.html#20293" class="Bound">w</a>
<a id="20331" href="/Soundness/#20146" class="Function">subst-zero-reflect</a> <a id="20350" class="Symbol">{</a><a id="20351" class="Argument">δ</a> <a id="20353" class="Symbol">=</a> <a id="20355" href="plfa.Soundness.html#20355" class="Bound">δ</a><a id="20356" class="Symbol">}</a> <a id="20358" class="Symbol">{</a><a id="20359" class="Argument">γ</a> <a id="20361" class="Symbol">=</a> <a id="20363" href="plfa.Soundness.html#20363" class="Bound">γ</a><a id="20364" class="Symbol">}</a> <a id="20366" href="plfa.Soundness.html#20366" class="Bound">δσγ</a> <a id="20370" class="Symbol">=</a> <a id="20372" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20374" href="/Denotational/#7545" class="Function">last</a> <a id="20379" href="plfa.Soundness.html#20363" class="Bound">γ</a> <a id="20381" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20383" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20385" href="plfa.Soundness.html#20413" class="Function">lemma</a> <a id="20391" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20393" href="plfa.Soundness.html#20366" class="Bound">δσγ</a> <a id="20397" href="/Untyped/#3295" class="InductiveConstructor">Z</a> <a id="20399" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="20401" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="20405" class="Keyword">where</a>
  <a id="20413" href="/Soundness/#20413" class="Function">lemma</a> <a id="20419" class="Symbol">:</a> <a id="20421" href="plfa.Soundness.html#20363" class="Bound">γ</a> <a id="20423" href="/Denotational/#8058" class="Function Operator">`⊑</a> <a id="20426" class="Symbol">(</a><a id="20427" href="plfa.Soundness.html#20355" class="Bound">δ</a> <a id="20429" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="20432" href="plfa.Denotational.html#7545" class="Function">last</a> <a id="20437" href="plfa.Soundness.html#20363" class="Bound">γ</a><a id="20438" class="Symbol">)</a>
  <a id="20442" href="/Soundness/#20413" class="Function">lemma</a> <a id="20448" href="/Untyped/#3295" class="InductiveConstructor">Z</a>  <a id="20451" class="Symbol">=</a>  <a id="20454" href="/Denotational/#5467" class="Function">Refl⊑</a>
  <a id="20462" href="/Soundness/#20413" class="Function">lemma</a> <a id="20468" class="Symbol">(</a><a id="20469" href="/Untyped/#3340" class="InductiveConstructor Operator">S</a> <a id="20471" href="plfa.Soundness.html#20471" class="Bound">x</a><a id="20472" class="Symbol">)</a> <a id="20474" class="Symbol">=</a> <a id="20476" href="/Compositional/#9665" class="Function">var-inv</a> <a id="20484" class="Symbol">(</a><a id="20485" href="plfa.Soundness.html#20366" class="Bound">δσγ</a> <a id="20489" class="Symbol">(</a><a id="20490" href="plfa.Untyped.html#3340" class="InductiveConstructor Operator">S</a> <a id="20492" href="plfa.Soundness.html#20471" class="Bound">x</a><a id="20493" class="Symbol">))</a>
</pre>
<p>We choose <code class="highlighter-rouge">w</code> to be the last value in <code class="highlighter-rouge">γ</code> and we obtain <code class="highlighter-rouge">δ ⊢ M ↓ w</code>
by applying the premise to variable <code class="highlighter-rouge">Z</code>. Finally, to prove
<code class="highlighter-rouge">γ ⊑ (δ , w)</code>, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of <code class="highlighter-rouge">w</code>.
In the induction case, <code class="highlighter-rouge">S x</code>, the premise
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> gives us <code class="highlighter-rouge">δ ⊢ x ↓ γ (S x)</code> and then
using <code class="highlighter-rouge">var-inv</code> we conclude that <code class="highlighter-rouge">γ (S x) ⊑ (δ </code>, w) (S x)`.</p>

<p>Now to prove that substitution reflects denotations.</p>

<pre class="Agda"><a id="substitution-reflect"></a><a id="20972" href="/Soundness/#20972" class="Function">substitution-reflect</a> <a id="20993" class="Symbol">:</a> <a id="20995" class="Symbol">∀</a> <a id="20997" class="Symbol">{</a><a id="20998" href="plfa.Soundness.html#20998" class="Bound">Δ</a><a id="20999" class="Symbol">}</a> <a id="21001" class="Symbol">{</a><a id="21002" href="plfa.Soundness.html#21002" class="Bound">δ</a> <a id="21004" class="Symbol">:</a> <a id="21006" href="/Denotational/#7096" class="Function">Env</a> <a id="21010" href="plfa.Soundness.html#20998" class="Bound">Δ</a><a id="21011" class="Symbol">}</a> <a id="21013" class="Symbol">{</a><a id="21014" href="plfa.Soundness.html#21014" class="Bound">N</a> <a id="21016" class="Symbol">:</a> <a id="21018" href="plfa.Soundness.html#20998" class="Bound">Δ</a> <a id="21020" href="/Untyped/#2944" class="InductiveConstructor Operator">,</a> <a id="21022" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a> <a id="21024" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="21026" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="21027" class="Symbol">}</a> <a id="21029" class="Symbol">{</a><a id="21030" href="plfa.Soundness.html#21030" class="Bound">M</a> <a id="21032" class="Symbol">:</a> <a id="21034" href="plfa.Soundness.html#20998" class="Bound">Δ</a> <a id="21036" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="21038" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="21039" class="Symbol">}</a> <a id="21041" class="Symbol">{</a><a id="21042" href="plfa.Soundness.html#21042" class="Bound">v</a><a id="21043" class="Symbol">}</a>
  <a id="21047" class="Symbol">→</a> <a id="21049" href="/Soundness/#21002" class="Bound">δ</a> <a id="21051" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="21053" href="plfa.Soundness.html#21014" class="Bound">N</a> <a id="21055" href="/Untyped/#7225" class="Function Operator">[</a> <a id="21057" href="plfa.Soundness.html#21030" class="Bound">M</a> <a id="21059" href="plfa.Untyped.html#7225" class="Function Operator">]</a> <a id="21061" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="21063" href="plfa.Soundness.html#21042" class="Bound">v</a>
    <a id="21069" class="Comment">------------------------------------------------</a>
  <a id="21120" class="Symbol">→</a> <a id="21122" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="21125" href="/Soundness/#21125" class="Bound">w</a> <a id="21127" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="21129" href="/Denotational/#3958" class="Datatype">Value</a> <a id="21135" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="21137" href="plfa.Soundness.html#21002" class="Bound">δ</a> <a id="21139" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="21141" href="plfa.Soundness.html#21030" class="Bound">M</a> <a id="21143" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="21145" href="plfa.Soundness.html#21125" class="Bound">w</a>  <a id="21148" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="21151" class="Symbol">(</a><a id="21152" href="plfa.Soundness.html#21002" class="Bound">δ</a> <a id="21154" href="plfa.Denotational.html#7253" class="Function Operator">`,</a> <a id="21157" href="plfa.Soundness.html#21125" class="Bound">w</a><a id="21158" class="Symbol">)</a> <a id="21160" href="plfa.Denotational.html#9270" class="Datatype Operator">⊢</a> <a id="21162" href="plfa.Soundness.html#21014" class="Bound">N</a> <a id="21164" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="21166" href="plfa.Soundness.html#21042" class="Bound">v</a>
<a id="21168" href="/Soundness/#20972" class="Function">substitution-reflect</a> <a id="21189" href="plfa.Soundness.html#21189" class="Bound">d</a> <a id="21191" class="Keyword">with</a> <a id="21196" href="plfa.Soundness.html#15667" class="Function">subst-reflect</a> <a id="21210" href="plfa.Soundness.html#21189" class="Bound">d</a> <a id="21212" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="21217" class="Symbol">...</a>  <a id="21222" class="Symbol">|</a> <a id="21224" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21226" href="/Soundness/#21226" class="Bound">γ</a> <a id="21228" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21230" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21232" href="plfa.Soundness.html#21232" class="Bound">δσγ</a> <a id="21236" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21238" href="plfa.Soundness.html#21238" class="Bound">γNv</a> <a id="21242" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21244" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21246" class="Keyword">with</a> <a id="21251" href="plfa.Soundness.html#20146" class="Function">subst-zero-reflect</a> <a id="21270" href="plfa.Soundness.html#21232" class="Bound">δσγ</a>
<a id="21274" class="Symbol">...</a>    <a id="21281" class="Symbol">|</a> <a id="21283" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21285" href="/Soundness/#21285" class="Bound">w</a> <a id="21287" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21289" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21291" href="plfa.Soundness.html#21291" class="Bound">ineq</a> <a id="21296" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21298" href="plfa.Soundness.html#21298" class="Bound">δMw</a> <a id="21302" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21304" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21306" class="Symbol">=</a> <a id="21308" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21310" href="plfa.Soundness.html#21285" class="Bound">w</a> <a id="21312" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21314" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21316" href="plfa.Soundness.html#21298" class="Bound">δMw</a> <a id="21320" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21322" href="/Denotational/#25004" class="Function">Env⊑</a> <a id="21327" class="Bound">γNv</a> <a id="21331" href="plfa.Soundness.html#21291" class="Bound">ineq</a> <a id="21336" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21338" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code> for some <code class="highlighter-rouge">γ</code>.
Using the former, the <code class="highlighter-rouge">subst-zero-reflect</code> lemma gives
us <code class="highlighter-rouge">γ ⊑ (δ , w)</code> and <code class="highlighter-rouge">δ ⊢ M ↓ w</code>. We conclude that
<code class="highlighter-rouge">δ , w ⊢ N ↓ v</code> by applying the <code class="highlighter-rouge">Env⊑</code> lemma, using
<code class="highlighter-rouge">γ ⊢ N ↓ v</code> and <code class="highlighter-rouge">γ ⊑ (δ , w)</code>.</p>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="21784" href="/Soundness/#21784" class="Function">reflect-beta</a> <a id="21797" class="Symbol">:</a> <a id="21799" class="Symbol">∀{</a><a id="21801" href="plfa.Soundness.html#21801" class="Bound">Γ</a><a id="21802" class="Symbol">}{</a><a id="21804" href="plfa.Soundness.html#21804" class="Bound">γ</a> <a id="21806" class="Symbol">:</a> <a id="21808" href="/Denotational/#7096" class="Function">Env</a> <a id="21812" href="plfa.Soundness.html#21801" class="Bound">Γ</a><a id="21813" class="Symbol">}{</a><a id="21815" href="plfa.Soundness.html#21815" class="Bound">M</a> <a id="21817" href="plfa.Soundness.html#21817" class="Bound">N</a><a id="21818" class="Symbol">}{</a><a id="21820" href="plfa.Soundness.html#21820" class="Bound">v</a><a id="21821" class="Symbol">}</a>
    <a id="21827" class="Symbol">→</a> <a id="21829" href="/Soundness/#21804" class="Bound">γ</a> <a id="21831" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="21833" class="Symbol">(</a><a id="21834" href="plfa.Soundness.html#21817" class="Bound">N</a> <a id="21836" href="/Untyped/#7225" class="Function Operator">[</a> <a id="21838" href="plfa.Soundness.html#21815" class="Bound">M</a> <a id="21840" href="plfa.Untyped.html#7225" class="Function Operator">]</a><a id="21841" class="Symbol">)</a> <a id="21843" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="21845" href="plfa.Soundness.html#21820" class="Bound">v</a>
    <a id="21851" class="Symbol">→</a> <a id="21853" href="/Soundness/#21804" class="Bound">γ</a> <a id="21855" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="21857" class="Symbol">(</a><a id="21858" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="21860" href="plfa.Soundness.html#21817" class="Bound">N</a><a id="21861" class="Symbol">)</a> <a id="21863" href="plfa.Untyped.html#4176" class="InductiveConstructor Operator">·</a> <a id="21865" href="plfa.Soundness.html#21815" class="Bound">M</a> <a id="21867" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="21869" href="plfa.Soundness.html#21820" class="Bound">v</a>
<a id="21871" href="/Soundness/#21784" class="Function">reflect-beta</a> <a id="21884" href="plfa.Soundness.html#21884" class="Bound">d</a>
    <a id="21890" class="Keyword">with</a> <a id="21895" href="/Soundness/#20972" class="Function">substitution-reflect</a> <a id="21916" href="plfa.Soundness.html#21884" class="Bound">d</a>
<a id="21918" class="Symbol">...</a> <a id="21922" class="Symbol">|</a> <a id="21924" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21926" href="/Soundness/#21926" class="Bound">v₂′</a> <a id="21930" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21932" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21934" href="plfa.Soundness.html#21934" class="Bound">d₁′</a> <a id="21938" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21940" href="plfa.Soundness.html#21940" class="Bound">d₂′</a> <a id="21944" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21946" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21948" class="Symbol">=</a> <a id="21950" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="21957" class="Symbol">(</a><a id="21958" href="plfa.Denotational.html#9541" class="InductiveConstructor">↦-intro</a> <a id="21966" href="plfa.Soundness.html#21940" class="Bound">d₂′</a><a id="21969" class="Symbol">)</a> <a id="21971" href="plfa.Soundness.html#21934" class="Bound">d₁′</a>


<a id="reflect"></a><a id="21977" href="/Soundness/#21977" class="Function">reflect</a> <a id="21985" class="Symbol">:</a> <a id="21987" class="Symbol">∀</a> <a id="21989" class="Symbol">{</a><a id="21990" href="plfa.Soundness.html#21990" class="Bound">Γ</a><a id="21991" class="Symbol">}</a> <a id="21993" class="Symbol">{</a><a id="21994" href="plfa.Soundness.html#21994" class="Bound">γ</a> <a id="21996" class="Symbol">:</a> <a id="21998" href="/Denotational/#7096" class="Function">Env</a> <a id="22002" href="plfa.Soundness.html#21990" class="Bound">Γ</a><a id="22003" class="Symbol">}</a> <a id="22005" class="Symbol">{</a><a id="22006" href="plfa.Soundness.html#22006" class="Bound">M</a> <a id="22008" href="plfa.Soundness.html#22008" class="Bound">M′</a> <a id="22011" href="plfa.Soundness.html#22011" class="Bound">N</a> <a id="22013" href="plfa.Soundness.html#22013" class="Bound">v</a><a id="22014" class="Symbol">}</a>
  <a id="22018" class="Symbol">→</a> <a id="22020" href="/Soundness/#21994" class="Bound">γ</a> <a id="22022" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="22024" href="plfa.Soundness.html#22011" class="Bound">N</a> <a id="22026" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="22028" href="plfa.Soundness.html#22013" class="Bound">v</a>  <a id="22031" class="Symbol">→</a>  <a id="22034" href="plfa.Soundness.html#22006" class="Bound">M</a> <a id="22036" href="/LambdaReduction/#345" class="Datatype Operator">—→</a> <a id="22039" href="plfa.Soundness.html#22008" class="Bound">M′</a>  <a id="22043" class="Symbol">→</a>   <a id="22047" href="plfa.Soundness.html#22008" class="Bound">M′</a> <a id="22050" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="22052" href="plfa.Soundness.html#22011" class="Bound">N</a>
    <a id="22058" class="Comment">---------------------------------</a>
  <a id="22094" class="Symbol">→</a> <a id="22096" href="/Soundness/#21994" class="Bound">γ</a> <a id="22098" href="/Denotational/#9270" class="Datatype Operator">⊢</a> <a id="22100" href="plfa.Soundness.html#22006" class="Bound">M</a> <a id="22102" href="plfa.Denotational.html#9270" class="Datatype Operator">↓</a> <a id="22104" href="plfa.Soundness.html#22013" class="Bound">v</a>
<a id="22106" href="/Soundness/#21977" class="Function">reflect</a> <a id="22114" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="22118" class="Symbol">(</a><a id="22119" href="/LambdaReduction/#395" class="InductiveConstructor">ξ₁</a> <a id="22122" href="plfa.Soundness.html#22122" class="Bound">r</a><a id="22123" class="Symbol">)</a> <a id="22125" class="Symbol">()</a>
<a id="22128" href="/Soundness/#21977" class="Function">reflect</a> <a id="22136" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="22140" class="Symbol">(</a><a id="22141" href="/LambdaReduction/#485" class="InductiveConstructor">ξ₂</a> <a id="22144" href="plfa.Soundness.html#22144" class="Bound">r</a><a id="22145" class="Symbol">)</a> <a id="22147" class="Symbol">()</a>
<a id="22150" href="/Soundness/#21977" class="Function">reflect</a><a id="22157" class="Symbol">{</a><a id="22158" class="Argument">γ</a> <a id="22160" class="Symbol">=</a> <a id="22162" href="plfa.Soundness.html#22162" class="Bound">γ</a><a id="22163" class="Symbol">}</a> <a id="22165" class="Symbol">(</a><a id="22166" href="/Denotational/#9324" class="InductiveConstructor">var</a><a id="22169" class="Symbol">{</a><a id="22170" class="Argument">x</a> <a id="22172" class="Symbol">=</a> <a id="22174" href="plfa.Soundness.html#22174" class="Bound">x</a><a id="22175" class="Symbol">})</a> <a id="22178" href="/LambdaReduction/#575" class="InductiveConstructor">β</a> <a id="22180" href="plfa.Soundness.html#22180" class="Bound">mn</a>
    <a id="22187" class="Keyword">with</a> <a id="22192" href="/Denotational/#9324" class="InductiveConstructor">var</a><a id="22195" class="Symbol">{</a><a id="22196" class="Argument">γ</a> <a id="22198" class="Symbol">=</a> <a id="22200" href="/Soundness/#22162" class="Bound">γ</a><a id="22201" class="Symbol">}{</a><a id="22203" class="Argument">x</a> <a id="22205" class="Symbol">=</a> <a id="22207" href="plfa.Soundness.html#22174" class="Bound">x</a><a id="22208" class="Symbol">}</a>
<a id="22210" class="Symbol">...</a> <a id="22214" class="Symbol">|</a> <a id="22216" href="/Soundness/#22216" class="Bound">d′</a> <a id="22219" class="Keyword">rewrite</a> <a id="22227" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22231" class="Bound">mn</a> <a id="22234" class="Symbol">=</a> <a id="22236" href="plfa.Soundness.html#21784" class="Function">reflect-beta</a> <a id="22249" href="plfa.Soundness.html#22216" class="Bound">d′</a>
<a id="22252" href="/Soundness/#21977" class="Function">reflect</a> <a id="22260" href="/Denotational/#9324" class="InductiveConstructor">var</a> <a id="22264" class="Symbol">(</a><a id="22265" href="/LambdaReduction/#683" class="InductiveConstructor">ζ</a> <a id="22267" href="plfa.Soundness.html#22267" class="Bound">r</a><a id="22268" class="Symbol">)</a> <a id="22270" class="Symbol">()</a>
<a id="22273" href="/Soundness/#21977" class="Function">reflect</a> <a id="22281" class="Symbol">(</a><a id="22282" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="22289" href="plfa.Soundness.html#22289" class="Bound">d₁</a> <a id="22292" href="plfa.Soundness.html#22292" class="Bound">d₂</a><a id="22294" class="Symbol">)</a> <a id="22296" class="Symbol">(</a><a id="22297" href="/LambdaReduction/#395" class="InductiveConstructor">ξ₁</a> <a id="22300" href="plfa.Soundness.html#22300" class="Bound">r</a><a id="22301" class="Symbol">)</a> <a id="22303" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22308" class="Symbol">=</a> <a id="22310" href="plfa.Denotational.html#9403" class="InductiveConstructor">↦-elim</a> <a id="22317" class="Symbol">(</a><a id="22318" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="22326" href="plfa.Soundness.html#22289" class="Bound">d₁</a> <a id="22329" href="plfa.Soundness.html#22300" class="Bound">r</a> <a id="22331" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22335" class="Symbol">)</a> <a id="22337" href="plfa.Soundness.html#22292" class="Bound">d₂</a>
<a id="22340" href="/Soundness/#21977" class="Function">reflect</a> <a id="22348" class="Symbol">(</a><a id="22349" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="22356" href="plfa.Soundness.html#22356" class="Bound">d₁</a> <a id="22359" href="plfa.Soundness.html#22359" class="Bound">d₂</a><a id="22361" class="Symbol">)</a> <a id="22363" class="Symbol">(</a><a id="22364" href="/LambdaReduction/#485" class="InductiveConstructor">ξ₂</a> <a id="22367" href="plfa.Soundness.html#22367" class="Bound">r</a><a id="22368" class="Symbol">)</a> <a id="22370" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22375" class="Symbol">=</a> <a id="22377" href="plfa.Denotational.html#9403" class="InductiveConstructor">↦-elim</a> <a id="22384" href="plfa.Soundness.html#22356" class="Bound">d₁</a> <a id="22387" class="Symbol">(</a><a id="22388" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="22396" href="plfa.Soundness.html#22359" class="Bound">d₂</a> <a id="22399" href="plfa.Soundness.html#22367" class="Bound">r</a> <a id="22401" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22405" class="Symbol">)</a>
<a id="22407" href="/Soundness/#21977" class="Function">reflect</a> <a id="22415" class="Symbol">(</a><a id="22416" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="22423" href="plfa.Soundness.html#22423" class="Bound">d₁</a> <a id="22426" href="plfa.Soundness.html#22426" class="Bound">d₂</a><a id="22428" class="Symbol">)</a> <a id="22430" href="/LambdaReduction/#575" class="InductiveConstructor">β</a> <a id="22432" href="plfa.Soundness.html#22432" class="Bound">mn</a>
    <a id="22439" class="Keyword">with</a> <a id="22444" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="22451" href="/Soundness/#22423" class="Bound">d₁</a> <a id="22454" href="plfa.Soundness.html#22426" class="Bound">d₂</a>
<a id="22457" class="Symbol">...</a> <a id="22461" class="Symbol">|</a> <a id="22463" href="/Soundness/#22463" class="Bound">d′</a> <a id="22466" class="Keyword">rewrite</a> <a id="22474" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22478" class="Bound">mn</a> <a id="22481" class="Symbol">=</a> <a id="22483" href="plfa.Soundness.html#21784" class="Function">reflect-beta</a> <a id="22496" href="plfa.Soundness.html#22463" class="Bound">d′</a>
<a id="22499" href="/Soundness/#21977" class="Function">reflect</a> <a id="22507" class="Symbol">(</a><a id="22508" href="/Denotational/#9403" class="InductiveConstructor">↦-elim</a> <a id="22515" href="plfa.Soundness.html#22515" class="Bound">d₁</a> <a id="22518" href="plfa.Soundness.html#22518" class="Bound">d₂</a><a id="22520" class="Symbol">)</a> <a id="22522" class="Symbol">(</a><a id="22523" href="/LambdaReduction/#683" class="InductiveConstructor">ζ</a> <a id="22525" href="plfa.Soundness.html#22525" class="Bound">r</a><a id="22526" class="Symbol">)</a> <a id="22528" class="Symbol">()</a>
<a id="22531" href="/Soundness/#21977" class="Function">reflect</a> <a id="22539" class="Symbol">(</a><a id="22540" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="22548" href="plfa.Soundness.html#22548" class="Bound">d</a><a id="22549" class="Symbol">)</a> <a id="22551" class="Symbol">(</a><a id="22552" href="/LambdaReduction/#395" class="InductiveConstructor">ξ₁</a> <a id="22555" href="plfa.Soundness.html#22555" class="Bound">r</a><a id="22556" class="Symbol">)</a> <a id="22558" class="Symbol">()</a>
<a id="22561" href="/Soundness/#21977" class="Function">reflect</a> <a id="22569" class="Symbol">(</a><a id="22570" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="22578" href="plfa.Soundness.html#22578" class="Bound">d</a><a id="22579" class="Symbol">)</a> <a id="22581" class="Symbol">(</a><a id="22582" href="/LambdaReduction/#485" class="InductiveConstructor">ξ₂</a> <a id="22585" href="plfa.Soundness.html#22585" class="Bound">r</a><a id="22586" class="Symbol">)</a> <a id="22588" class="Symbol">()</a>
<a id="22591" href="/Soundness/#21977" class="Function">reflect</a> <a id="22599" class="Symbol">(</a><a id="22600" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="22608" href="plfa.Soundness.html#22608" class="Bound">d</a><a id="22609" class="Symbol">)</a> <a id="22611" href="/LambdaReduction/#575" class="InductiveConstructor">β</a> <a id="22613" href="plfa.Soundness.html#22613" class="Bound">mn</a>
    <a id="22620" class="Keyword">with</a> <a id="22625" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="22633" href="/Soundness/#22608" class="Bound">d</a>
<a id="22635" class="Symbol">...</a> <a id="22639" class="Symbol">|</a> <a id="22641" href="/Soundness/#22641" class="Bound">d′</a> <a id="22644" class="Keyword">rewrite</a> <a id="22652" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22656" class="Bound">mn</a> <a id="22659" class="Symbol">=</a> <a id="22661" href="plfa.Soundness.html#21784" class="Function">reflect-beta</a> <a id="22674" href="plfa.Soundness.html#22641" class="Bound">d′</a>
<a id="22677" href="/Soundness/#21977" class="Function">reflect</a> <a id="22685" class="Symbol">(</a><a id="22686" href="/Denotational/#9541" class="InductiveConstructor">↦-intro</a> <a id="22694" href="plfa.Soundness.html#22694" class="Bound">d</a><a id="22695" class="Symbol">)</a> <a id="22697" class="Symbol">(</a><a id="22698" href="/LambdaReduction/#683" class="InductiveConstructor">ζ</a> <a id="22700" href="plfa.Soundness.html#22700" class="Bound">r</a><a id="22701" class="Symbol">)</a> <a id="22703" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22708" class="Symbol">=</a> <a id="22710" href="plfa.Denotational.html#9541" class="InductiveConstructor">↦-intro</a> <a id="22718" class="Symbol">(</a><a id="22719" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="22727" href="plfa.Soundness.html#22694" class="Bound">d</a> <a id="22729" href="plfa.Soundness.html#22700" class="Bound">r</a> <a id="22731" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22735" class="Symbol">)</a>
<a id="22737" href="/Soundness/#21977" class="Function">reflect</a> <a id="22745" href="/Denotational/#9665" class="InductiveConstructor">⊥-intro</a> <a id="22753" href="plfa.Soundness.html#22753" class="Bound">r</a> <a id="22755" href="plfa.Soundness.html#22755" class="Bound">mn</a> <a id="22758" class="Symbol">=</a> <a id="22760" href="plfa.Denotational.html#9665" class="InductiveConstructor">⊥-intro</a>
<a id="22768" href="/Soundness/#21977" class="Function">reflect</a> <a id="22776" class="Symbol">(</a><a id="22777" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="22785" href="plfa.Soundness.html#22785" class="Bound">d₁</a> <a id="22788" href="plfa.Soundness.html#22788" class="Bound">d₂</a><a id="22790" class="Symbol">)</a> <a id="22792" href="plfa.Soundness.html#22792" class="Bound">r</a> <a id="22794" href="plfa.Soundness.html#22794" class="Bound">mn</a> <a id="22797" class="Keyword">rewrite</a> <a id="22805" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22809" href="plfa.Soundness.html#22794" class="Bound">mn</a> <a id="22812" class="Symbol">=</a>
   <a id="22817" href="/Denotational/#9740" class="InductiveConstructor">⊔-intro</a> <a id="22825" class="Symbol">(</a><a id="22826" href="/Soundness/#21977" class="Function">reflect</a> <a id="22834" href="plfa.Soundness.html#22785" class="Bound">d₁</a> <a id="22837" href="plfa.Soundness.html#22792" class="Bound">r</a> <a id="22839" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22843" class="Symbol">)</a> <a id="22845" class="Symbol">(</a><a id="22846" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="22854" href="plfa.Soundness.html#22788" class="Bound">d₂</a> <a id="22857" href="plfa.Soundness.html#22792" class="Bound">r</a> <a id="22859" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22863" class="Symbol">)</a>
<a id="22865" href="/Soundness/#21977" class="Function">reflect</a> <a id="22873" class="Symbol">(</a><a id="22874" href="/Denotational/#9871" class="InductiveConstructor">sub</a> <a id="22878" href="plfa.Soundness.html#22878" class="Bound">d</a> <a id="22880" href="plfa.Soundness.html#22880" class="Bound">lt</a><a id="22882" class="Symbol">)</a> <a id="22884" href="plfa.Soundness.html#22884" class="Bound">r</a> <a id="22886" href="plfa.Soundness.html#22886" class="Bound">mn</a> <a id="22889" class="Symbol">=</a> <a id="22891" href="plfa.Denotational.html#9871" class="InductiveConstructor">sub</a> <a id="22895" class="Symbol">(</a><a id="22896" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="22904" href="plfa.Soundness.html#22878" class="Bound">d</a> <a id="22906" href="plfa.Soundness.html#22884" class="Bound">r</a> <a id="22908" href="plfa.Soundness.html#22886" class="Bound">mn</a><a id="22910" class="Symbol">)</a> <a id="22912" href="plfa.Soundness.html#22880" class="Bound">lt</a>
</pre>
<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23087" href="/Soundness/#23087" class="Function">reduce-equal</a> <a id="23100" class="Symbol">:</a> <a id="23102" class="Symbol">∀</a> <a id="23104" class="Symbol">{</a><a id="23105" href="plfa.Soundness.html#23105" class="Bound">Γ</a><a id="23106" class="Symbol">}</a> <a id="23108" class="Symbol">{</a><a id="23109" href="plfa.Soundness.html#23109" class="Bound">M</a> <a id="23111" class="Symbol">:</a> <a id="23113" href="plfa.Soundness.html#23105" class="Bound">Γ</a> <a id="23115" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="23117" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="23118" class="Symbol">}</a> <a id="23120" class="Symbol">{</a><a id="23121" href="plfa.Soundness.html#23121" class="Bound">N</a> <a id="23123" class="Symbol">:</a> <a id="23125" href="plfa.Soundness.html#23105" class="Bound">Γ</a> <a id="23127" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="23129" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="23130" class="Symbol">}</a>
  <a id="23134" class="Symbol">→</a> <a id="23136" href="/Soundness/#23109" class="Bound">M</a> <a id="23138" href="/LambdaReduction/#345" class="Datatype Operator">—→</a> <a id="23141" href="plfa.Soundness.html#23121" class="Bound">N</a>
    <a id="23147" class="Comment">---------</a>
  <a id="23159" class="Symbol">→</a> <a id="23161" href="/Denotational/#17211" class="Function">ℰ</a> <a id="23163" href="/Soundness/#23109" class="Bound">M</a> <a id="23165" href="plfa.Denotational.html#17393" class="Function Operator">≃</a> <a id="23167" href="plfa.Denotational.html#17211" class="Function">ℰ</a> <a id="23169" href="plfa.Soundness.html#23121" class="Bound">N</a>
<a id="23171" href="/Soundness/#23087" class="Function">reduce-equal</a> <a id="23184" class="Symbol">{</a><a id="23185" href="plfa.Soundness.html#23185" class="Bound">Γ</a><a id="23186" class="Symbol">}{</a><a id="23188" href="plfa.Soundness.html#23188" class="Bound">M</a><a id="23189" class="Symbol">}{</a><a id="23191" href="plfa.Soundness.html#23191" class="Bound">N</a><a id="23192" class="Symbol">}</a> <a id="23194" href="plfa.Soundness.html#23194" class="Bound">r</a> <a id="23196" href="plfa.Soundness.html#23196" class="Bound">γ</a> <a id="23198" href="plfa.Soundness.html#23198" class="Bound">v</a> <a id="23200" class="Symbol">=</a>
    <a id="23206" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23208" class="Symbol">(λ</a> <a id="23211" href="/Soundness/#23211" class="Bound">m</a> <a id="23213" class="Symbol">→</a> <a id="23215" href="plfa.Soundness.html#6673" class="Function">preserve</a> <a id="23224" href="plfa.Soundness.html#23211" class="Bound">m</a> <a id="23226" href="plfa.Soundness.html#23194" class="Bound">r</a><a id="23227" class="Symbol">)</a> <a id="23229" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23231" class="Symbol">(λ</a> <a id="23234" href="plfa.Soundness.html#23234" class="Bound">n</a> <a id="23236" class="Symbol">→</a> <a id="23238" href="plfa.Soundness.html#21977" class="Function">reflect</a> <a id="23246" href="plfa.Soundness.html#23234" class="Bound">n</a> <a id="23248" href="plfa.Soundness.html#23194" class="Bound">r</a> <a id="23250" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="23254" class="Symbol">)</a> <a id="23256" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="23421" href="/Soundness/#23421" class="Function">soundness</a> <a id="23431" class="Symbol">:</a> <a id="23433" class="Symbol">∀{</a><a id="23435" href="plfa.Soundness.html#23435" class="Bound">Γ</a><a id="23436" class="Symbol">}</a> <a id="23438" class="Symbol">{</a><a id="23439" href="plfa.Soundness.html#23439" class="Bound">M</a> <a id="23441" class="Symbol">:</a> <a id="23443" href="plfa.Soundness.html#23435" class="Bound">Γ</a> <a id="23445" href="/Untyped/#4028" class="Datatype Operator">⊢</a> <a id="23447" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="23448" class="Symbol">}</a> <a id="23450" class="Symbol">{</a><a id="23451" href="plfa.Soundness.html#23451" class="Bound">N</a> <a id="23453" class="Symbol">:</a> <a id="23455" href="plfa.Soundness.html#23435" class="Bound">Γ</a> <a id="23457" href="plfa.Untyped.html#2944" class="InductiveConstructor Operator">,</a> <a id="23459" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a> <a id="23461" href="plfa.Untyped.html#4028" class="Datatype Operator">⊢</a> <a id="23463" href="plfa.Untyped.html#2652" class="InductiveConstructor">★</a><a id="23464" class="Symbol">}</a>
  <a id="23468" class="Symbol">→</a> <a id="23470" href="/Soundness/#23439" class="Bound">M</a> <a id="23472" href="/LambdaReduction/#837" class="Datatype Operator">—↠</a> <a id="23475" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="23477" href="plfa.Soundness.html#23451" class="Bound">N</a>
    <a id="23483" class="Comment">-----------------</a>
  <a id="23503" class="Symbol">→</a> <a id="23505" href="/Denotational/#17211" class="Function">ℰ</a> <a id="23507" href="/Soundness/#23439" class="Bound">M</a> <a id="23509" href="plfa.Denotational.html#17393" class="Function Operator">≃</a> <a id="23511" href="plfa.Denotational.html#17211" class="Function">ℰ</a> <a id="23513" class="Symbol">(</a><a id="23514" href="/Untyped/#4116" class="InductiveConstructor Operator">ƛ</a> <a id="23516" href="plfa.Soundness.html#23451" class="Bound">N</a><a id="23517" class="Symbol">)</a>
<a id="23519" href="/Soundness/#23421" class="Function">soundness</a> <a id="23529" class="Symbol">(</a><a id="23530" class="DottedPattern Symbol">.(</a><a id="23532" href="/Untyped/#4116" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="23534" class="DottedPattern Symbol">_)</a> <a id="23537" href="/LambdaReduction/#887" class="InductiveConstructor Operator">[]</a><a id="23539" class="Symbol">)</a> <a id="23541" href="plfa.Soundness.html#23541" class="Bound">γ</a> <a id="23543" href="plfa.Soundness.html#23543" class="Bound">v</a> <a id="23545" class="Symbol">=</a> <a id="23547" href="https://agda.github.io/agda-stdlib/v1.1/Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23549" class="Symbol">(λ</a> <a id="23552" href="plfa.Soundness.html#23552" class="Bound">x</a> <a id="23554" class="Symbol">→</a> <a id="23556" href="plfa.Soundness.html#23552" class="Bound">x</a><a id="23557" class="Symbol">)</a> <a id="23559" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23561" class="Symbol">(λ</a> <a id="23564" href="plfa.Soundness.html#23564" class="Bound">x</a> <a id="23566" class="Symbol">→</a> <a id="23568" href="plfa.Soundness.html#23564" class="Bound">x</a><a id="23569" class="Symbol">)</a> <a id="23571" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="23573" href="/Soundness/#23421" class="Function">soundness</a> <a id="23583" class="Symbol">{</a><a id="23584" href="plfa.Soundness.html#23584" class="Bound">Γ</a><a id="23585" class="Symbol">}</a> <a id="23587" class="Symbol">(</a><a id="23588" href="plfa.Soundness.html#23588" class="Bound">L</a> <a id="23590" href="/LambdaReduction/#944" class="InductiveConstructor Operator">—→⟨</a> <a id="23594" href="plfa.Soundness.html#23594" class="Bound">r</a> <a id="23596" href="plfa.LambdaReduction.html#944" class="InductiveConstructor Operator">⟩</a> <a id="23598" href="plfa.Soundness.html#23598" class="Bound">M—↠N</a><a id="23602" class="Symbol">)</a> <a id="23604" href="plfa.Soundness.html#23604" class="Bound">γ</a> <a id="23606" href="plfa.Soundness.html#23606" class="Bound">v</a> <a id="23608" class="Symbol">=</a>
   <a id="23613" class="Keyword">let</a> <a id="23617" href="/Soundness/#23617" class="Bound">ih</a> <a id="23620" class="Symbol">=</a> <a id="23622" href="plfa.Soundness.html#23421" class="Function">soundness</a> <a id="23632" href="plfa.Soundness.html#23598" class="Bound">M—↠N</a> <a id="23637" class="Keyword">in</a>
   <a id="23643" class="Keyword">let</a> <a id="23647" href="/Soundness/#23647" class="Bound">e</a> <a id="23649" class="Symbol">=</a> <a id="23651" href="plfa.Soundness.html#23087" class="Function">reduce-equal</a> <a id="23664" href="plfa.Soundness.html#23594" class="Bound">r</a> <a id="23666" class="Keyword">in</a>
   <a id="23672" href="/Denotational/#17798" class="Function">≃-trans</a> <a id="23680" class="Symbol">{</a><a id="23681" href="/Soundness/#23584" class="Bound">Γ</a><a id="23682" class="Symbol">}</a> <a id="23684" href="plfa.Soundness.html#23647" class="Bound">e</a> <a id="23686" href="plfa.Soundness.html#23617" class="Bound">ih</a> <a id="23689" href="plfa.Soundness.html#23604" class="Bound">γ</a> <a id="23691" href="plfa.Soundness.html#23606" class="Bound">v</a>
</pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<script type="text/javascript">

 // Makes sandwhich menu works
 $('.menu-icon').click(function(){
   $('.trigger').toggle();
 });

 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
